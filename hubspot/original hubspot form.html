<script type="text/javascript" src="https://www.usefomo.com/api/v1/M949IjzF31-KIUyo8hY58g/load.js" async></script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T4JW3M7');</script>
<!-- End Google Tag Manager -->



<!-- Signup code - DONT TOUCH! -->

<style type="text/css">
    [data-form-id="bccafcb5-2405-4d07-92be-dad8713d94e2"] .hs-form-field, .hs_submit{
        display: none;
    }
    [data-form-id="bccafcb5-2405-4d07-92be-dad8713d94e2"] .hs_name.hs-form-field{
        display: block;
    }
    [data-form-id="bccafcb5-2405-4d07-92be-dad8713d94e2"] .hs_email.hs-form-field{
        display: block;
    }
</style>

<script>

window.addEventListener("error", function (e) {
   alert("Error occured: " + e.error.message);
   return false;
})

function getParameterByName(name) {
    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
}

function cleanQuerystring() {
    try {window.history.replaceState({}, document.title, location.origin+location.pathname);}
    catch (err){}
}

    var $company, $custom_url, $name, $url, $email, $password, $confirm_password, $submit;

        function seterror(element, text, isclear)
        {
            element[0].validationMessage = isclear ? "": "Incorrect";
            (element.next("ul") || {}).remove();
            if (!isclear){
            element[0].classList.add("error");
            element[0].classList.add("invalid");
            if (text)
            element.after('<ul class="hs-error-msgs inputs-list hs-error-msgs1" style="display:block;"><li><label>'+text+'</label></li></ul>');
            }   
            else
            {
            element[0].classList.remove("error");
            element[0].classList.remove("invalid");
            }
            $submit.attr("disabled", isclear && !$("ul.hs-error-msgs1").length ? false : true);
        }

        function init_vars($form)
        {
            $form = $($form);
        $company = $form.find( "input[name='company']" );
        $name = $form.find( "input[name='name']" );
        $custom_url = $form.find( "input[name='custom_url']" );
        $url = $form.find("strong:contains('yourcompanyname')");
        $email = $form.find( "input[name='email']" );
        $password = $form.find( "input[name='password']" );
        $confirm_password = $form.find( "input[name='confirm_password']" );
        $submit = $form.find( "input[type='submit']" );
        
        $custom_url.parent().css('position', 'relative');
        $custom_url.attr('maxlength','20');
        $custom_url.after("<div class='HolderOrgDomain'>.sherpadesk.com</div>");
        
        }
        
        </script>
        
        <style>
            .HolderOrgDomain{
    position: absolute; 
    top: 12px; 
    right: 16px; 
    font: 18px Arial; 
    font-weight: 400; 
    letter-spacing: 0.5px; 
    display: inline;"
}

@media only screen and (max-width: 530px) and (min-width: 400px)  {
   .HolderOrgDomain{
       top: 14px;
       font-size:85%;
   } 
   
   input::-webkit-input-placeholder{
       font-size:100%;
   }
   .hs-input{
       font-size:85% !important;
   }
    
}

@media only screen and (max-width: 400px){
     .HolderOrgDomain{
       font-size:69% !important;
       top: 14px;
   } 
   
   input::-webkit-input-placeholder{
       font-size:69%;
   }
    .hs-input{
       font-size:69% !important;
   }
}


        </style>
        
        <!-- End Signup code - DONT TOUCH! -->


        <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4JW3M7"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- Signup code - DONT TOUCH! -->

<iframe hidden name="hubspot-iframe" id="hubspot-iframe"></iframe>

<script>

    var testpage = getParameterByName("testpage");

    var interval = setInterval(function(){
        var $form = $('.hs-form');
if ($form && $form[0]){
    if(~$form[0].id.indexOf("5c0b2305-776b-4492-b91d-80d92fa33688") || ~$form[0].id.indexOf("a57eec43-c101-44a8-b854-620b62921ce5") || ~$form[0].id.indexOf("cd8dc236-f403-4c92-b31d-f6962fe07983"))
    {
    clearInterval(window.interval);
    onFormReady($($form[0]));
    }
    else if(~$form[0].id.indexOf("bccafcb5-2405-4d07-92be-dad8713d94e2"))
            {
                clearInterval(window.interval);
            }
    
    
}
}, 200);

setTimeout(function(){clearInterval(window.interval);}, 3000);

function onFormReady($form){
    console.log("prod"+$form[0].id);
    $('body').on('hsvalidatedsubmit', $form, function (e) {
        e.preventDefault();
  var form = $(e.target); 

  if(~form[0].id.indexOf("5c0b2305-776b-4492-b91d-80d92fa33688")  || ~$form[0].id.indexOf("a57eec43-c101-44a8-b854-620b62921ce5") || ~form[0].id.indexOf("cd8dc236-f403-4c92-b31d-f6962fe07983"))
    {
  onFormSubmit(form);
    }
});
        
    $($form).prop('target', 'hubspot-iframe');
        init_vars($form);
        
            $company.val("").change();
              $email.val("").change();
               $custom_url.val("").change();
                $name.val("").change();
                $password.val("").change();
                $confirm_password.val("").change();
                
                setTimeout(function(){$("li","ul.hs-error-msgs").remove()}, 10);
                
        $password.prop("type", "password");
        $confirm_password.prop("type", "password");
        
        function safechar(text)
        {
            return (text || "").toLowerCase().replace(/[^a-zA-Z0-9-]/g, '').trim();
        }

        $company.change(function() {
            var company = $(this).val();
            if(company && !$custom_url.val()){
                var url = safechar(company);
                $custom_url.val(url).change();
                ($url[0] || {}).innerText = url; 
            }
        });

        $password.change(function() {
            var password = $(this).val();
            if(password){
              if (password.trim().length < 5){ 
                seterror($(this), "Password must be not less than 5 chars.");
                return;
            }
            else
                seterror($password, "", true);
            if ($confirm_password.val().length > 0 && $confirm_password.val() != password){ 
                seterror($confirm_password, "Passwords must match.");
                return;
            }
            else
                seterror($confirm_password, "", true);
        }
            seterror($(this), "", true);
        });

        $confirm_password.focusout(function() {
            var password = $password.val();
            var confirm_password = $confirm_password.val();

            if(password && confirm_password == password){ 
                seterror($(this), "", true);
            }
            else if (confirm_password && password !=confirm_password)
                seterror($(this), "Passwords must match.");
        });

        $custom_url.change(function() {
            var url = safechar($(this).val());
            if ($(this).val() != url)
            {
                $custom_url.val(url).change();
            }
            ($url[0] || {}).innerText = url || "yourcompanyname"; 
            if (url)
            {
                if (url.length < 3 || url.length > 20)
                { 
                seterror($(this), "This Url is incorrect. Please enter between 3 and 20 characters.");
                return;
                }
                var xhr = new XMLHttpRequest();
                xhr.open('GET', "http://api.sherpadesk.com/validate_organization?format=json&url="+url, true);
                xhr.onload = function(e) { 
                    if (e.target.status == 200)
                    {
                        var data = JSON.parse(e.target.response);
                        if (data.isUrlExists)
                        {
                            seterror($custom_url, "This Url is already in use");
                        }
                        else
                            seterror($custom_url, "", true);
                    }
                    else
                    {
                        //alert(e.target.response);
                        console.log(e);
                    }
                }
                xhr.send();
            }
            else
                seterror($custom_url, "", true);
            //console.log($(this).val());
        });
    }

function onFormSubmit($form){
        //console.log('$form', $form); 
        init_vars($form);
        seterror($submit, "Redirecting to SherpaDesk app. Please wait...");

        var pass1 = $password.val(), 
                pass2 = $confirm_password.val();
                
                $password.val("").change();
                $confirm_password.val("").change();

            var formData = new FormData();

                formData.append("name", $company.val());
                formData.append("email", $email.val());
                formData.append("url", $custom_url.val());
                formData.append("firstname", $name.val());
                formData.append("lastname", " ");
                formData.append("password", pass1);
                formData.append("password_confirm", pass2);
                formData.append("how", "Hubspot");
                formData.append("note", "by start your climb page");

                // Append extra data before send.
                formData.append('is_force_registration', 'true'); 
                formData.append('is_force_redirect', 'true');
                formData.append("is_send_hubSpot", "false");

            var xhr = new XMLHttpRequest();
                xhr.open('POST', "http://api.sherpadesk.com/organizations?format=json", true);
                xhr.onload = function(e) { 
                    if (e.target.status == 200 || e.target.status == 201)
                    {
                        var data = JSON.parse(e.target.response);
                        //if (testpage)
                        //{
                            var res = encodeURIComponent(data.url);
                            window.location = "https://www.sherpadesk.com/thank-you?redirect="+res;
                            //return;
                        //}
                        //window.location = data.url;
                    }
                    else
                    {
                        seterror($submit, "Error occured: " + (e.target.response || e.target.status) +". Please contact SherpaDesk administrator (support@sherpadesk.com)");
                        $custom_url.change();
                        $password.val(pass1).change();
                        $confirm_password.val(pass2).change();
                        //console.log(e);
                    } 
                }
                xhr.onerror = function () {
                    console.log("** An error occurred during the transaction");
                    $password.val(pass1).change();
                    $confirm_password.val(pass2).change();
                    seterror($submit, "Error occured. Please try again later or contact SherpaDesk administrator (support@sherpadesk.com)");
                };

                xhr.send(formData);
                
                setTimeout(function(){seterror($submit, "", true)}, 6000);
    }
          
    </script>
      <!-- End Signup code - DONT TOUCH! -->