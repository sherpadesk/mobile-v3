<!-- Google Tag Manager (noscript) --> 
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4JW3M7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

<!-- Google Code for Adwords Conversion Conversion Page -->
    <script type="text/javascript"> 
        /* <![CDATA[ */
      var google_conversion_id = 1040470683;
      var google_conversion_label = "IUuFCP62ynUQm6WR8AM";
      var google_remarketing_only = "false";
      var google_conversion_value = 0;
      if(testpage)
    {
        google_conversion_id = 0;
        google_conversion_label = "";
    }
    //else if (~location.href.indexOf("thank-you")){
    //    var element = document.createElement("script");
    //    element.src = "//www.googleadservices.com/pagead/conversion.js";
    //    document.body.appendChild(element);
    //}
      /* ]]> */ 
  </script>

<!-- Google Code for Adwords Conversion Conversion Page -->
<script type="text/javascript" src="https://www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
  <img height=1 width=1 border=0 
  src="//www.googleadservices.com/pagead/
  conversion/1040470683/?value=0&amp;label=IUuFCP62ynUQm6WR8AM&amp;guid=ON&amp;script=0">
</noscript>
<!-- Signup code - DONT TOUCH! -->

<iframe hidden name="hubspot-iframe" id="hubspot-iframe"></iframe>

<script>// <![CDATA[

    var num_click=0;
    //var x = window.matchMedia("(max-width: 767px)");
    /*function hideNext(x) {
    if (x.matches) { // If media query matches
        $("#next_step").hide();
    } else {
        $("#next_step").show();
    }
}*/
function nextStepDesktop(){
    if(!$('div.NO-NextStep').length && !$('#next_step').length) {
        $("<center><button id='next_step'> </button></center>").insertBefore('h3:contains("*Base Camp Subscription")');
    }
//hideNext(x); // Call listener function at run time
//x.addListener(hideNext); // Attach listener function on state changes

$("#next_step").click(function(){
    num_click++;
    if (num_click==1) {
     $name.keypress();
     $email.keypress();

 }
 else if (num_click==2) {
  $company.keypress();
  $url.keypress();

} 
else if (num_click >= 3) {
    $(".hs_captcha-base").fadeIn('slow');
    $(".hs_captcha-base__input").fadeIn('slow');

    var $cap_text = $("#captcha-base__input");

    if ($cap_text.val().length == 0)
        seterror($cap_text, "Verification code is empty.");
    else
        seterror($cap_text, "", true);

  //$divcaptcha_base.fadeIn('slow');
  //$div_hs_captcha_input.fadeIn('slow');

  //$divTechs.fadeIn('slow');
  //$techs.focus();
  //$("#next_step").hide();
} 

});
}
  
// ]]></script>
<script>

//set how
function set_how()
{
    var test = $("input[name=hs_context]");
    test = test && test.first();
    if (test)
    {
        var obj = test.val();
        if (obj && obj.length)
        {
           obj = JSON.parse(obj);
           test = obj.urlParams || {}; 
           localStorage.setItem("utm_campaign", test.utm_campaign || localStorage.utm_campaign || "");
           if (test.utm_content)
               test.utm_content = obj.pageTitle || test.utm_content;
           localStorage.setItem("utm_content", test.utm_content || localStorage.utm_content || "");
           localStorage.setItem("utm_medium", test.utm_medium || localStorage.utm_medium || "");
           localStorage.setItem("utm_source", test.utm_source || localStorage.utm_source || "");
           if (obj.referrer && !~obj.referrer.indexOf("sherpadesk.com"))
            localStorage.setItem("referrer", obj.referrer || "");
    }
}
}

// sigup image preload
var images = new Array();
function preload() {
    for (i = 0; i < preload.arguments.length; i++) {
     images[i] = new Image();
     images[i].src = preload.arguments[i];
 }
}


function get_how(myreferral){

    var how = '';
    if (myreferral)
         how += "Referral: " + myreferral + ' ';

    var nav = navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/);
    nav = nav && nav[0] || "Desktop";

    var referrer = localStorage.referrer || "";
    if (referrer.length > 50) referrer = referrer.substring(0,50); 
        how += "from " + nav +" " + referrer + " ";
    if (localStorage.utm_medium || localStorage.utm_source)
        how += "by " + localStorage.utm_medium + "(" + localStorage.utm_source + ") "
    if (localStorage.utm_campaign)
        how += "in campaign:" + localStorage.utm_campaign + " ";
    if (localStorage.utm_content)
        how += "(" + localStorage.utm_content + ")";
    return how.substring(0,254);
}

var interval = setInterval(function(){
    var $form = $('.hs-form');
    if ($form && $form[0]){
        if(~$form[0].id.indexOf("bccafcb5-2405-4d07-92be-dad8713d94e2") || ~$form[0].id.indexOf("c4d7787a-b79b-4b8a-bcb8-1119a0685822"))
        {
            clearInterval(window.interval);
            onFormReady1($($form[0]));
        }


    }
}, 200);

setTimeout(function(){clearInterval(window.interval);set_how();}, 3000);
setTimeout(function(){
    if (res)
        $("#anivideo").prepend("<br/><br/><a style='color:#002d52' href='" + "https://www.sherpadesk.com/thank-you?redirect="+res+"'>Please click here if page is not redirected...</a>")
}, 20000);

function safechar(text)
{
    return (text || "").toLowerCase().replace(/[^a-zA-Z0-9-]/g, '').trim();
}

function onFormReady1($form){
    preload(
       "https://cdn2.hubspot.net/hubfs/2629098/Rocket%20LP/Buttons_Start%20a%20Free%20Trial%20Blue_small.png",
       "https://cdn2.hubspot.net/hubfs/2629098/Rocket%20LP/Buttons_Start%20a%20Free%20Trial%20(Orange)_small.png",
       "https://cdn2.hubspot.net/hubfs/2629098/Rocket%20LP/BIG-ROCKET_without-fire_v2.png"
       );
    console.log("test"+$form[0].id);

    var a=document.createElement("script");a.src="https://f.hubspotusercontent40.net/hubfs/2629098/Sherpadesknov2016/Js/app_compile.js";document.body.appendChild(a);

    setTimeout(function(){
      $(".hs-button").attr('id', 'ImageButton');
  },1000);

    $('body').on('hsvalidatedsubmit', $form, function (e) {
        e.preventDefault();
            //if (testpage) { $captcha.val("sdjkhaskdjhg"); }
        //console.log($captcha.val());
        var form = $(e.target); 

        if(~form[0].id.indexOf("bccafcb5-2405-4d07-92be-dad8713d94e2") || ~$form[0].id.indexOf("c4d7787a-b79b-4b8a-bcb8-1119a0685822"))
        {
          onFormSubmit1(form);
      }
  });

    $($form).prop('target', 'hubspot-iframe');
    $form.append("<div id='lock-modal10'></div><div id='loading-circle10'></div><div class='head-text-form' id='motto10'>Your business is about to take off...</div>");

    init_vars($form);

    nextStepDesktop();
  
    
    $name.val(getParameterByName('name') || $name.val() || "").change().focus(); 
    $company.val(getParameterByName('company') || "").change();
    $email.val(getParameterByName('email') || "").change();
    $custom_url.val(getParameterByName('url') || "").change();

    $password.val("").change();
    $confirm_password.val("").change();
    $referral.val("").change();
  
  if ($custom_url.val()){
    $divEmail.fadeIn();
    $divCaptcha.fadeIn();
    $divCompany.fadeIn();
    $divUrl.fadeIn();
    $divPass1.fadeIn();
    $divPass2.fadeIn();
  }
 

    if ($name.val()){
        $divEmail.fadeIn('slow');
        $divCaptcha.fadeIn('slow');}

   /* $name.keypress(function(){
        $divEmail.fadeIn('slow');$(this).unbind(event);});
    $name.change(function(){
        $divEmail.fadeIn('slow');$email.focus();});*/
        $name.keypress(function(){
                if ($email.val()!=""){
            $divCompany.fadeIn('slow');$divUrl.fadeIn('slow');}});
        $name.change(function(){
                if ($email.val() !=""){
            $divCompany.fadeIn('slow');$divUrl.fadeIn('slow');}
          });   
        $email.keypress(function(){
                if ($name.val()!=""){
            $divCompany.fadeIn('slow');$divUrl.fadeIn('slow');}});
        
        $company.keypress(function(){
            $divPass1.fadeIn('slow');
            $divPass2.fadeIn('slow');
            $(".hs_captcha-base").fadeIn('slow');
    $(".hs_captcha-base__input").fadeIn('slow');
          $(".legal-consent-container").fadeIn('slow');
        });
        $company.change(function(){
            $divPass1.fadeIn('slow');
            $divPass2.fadeIn('slow');
            $(".hs_captcha-base").fadeIn('slow');
    $(".hs_captcha-base__input").fadeIn('slow');
          $(".legal-consent-container").fadeIn('slow');
        });
        $industry.focus(function(){
           if($industry.val()) $divTechs.fadeIn('slow');
           if($industry.val()) { if ($divReferral.length) $divReferral.fadeIn('slow'); }
           //if($divTechs.is(':visible') && $techs.val()) {$("#next_step").hide();$divSubmit.fadeIn('slow');}
       });
        $industry.change(function(){
          var password = $password.val();
            var confirm_password = $confirm_password.val();
          if (password && password !=confirm_password)
                seterror($($confirm_password), "Passwords must match.");
          else
                seterror($confirm_password, "", true);
            if($industry.val()) $divTechs.fadeIn('slow');
            if($industry.val()) { if ($divReferral.length) $divReferral.fadeIn('slow'); }
            //if($divTechs.is(':visible') && $techs.val()) {$("#next_step").hide();$divSubmit.fadeIn('slow');}     
        });
        //$techs.change(function(){
        //    $("#next_step").hide();
        //    $divSubmit.fadeIn('slow');/*$divFeatures.fadeIn('slow');*/});
        //$techs.focus(function(){
        //    $("#next_step").hide();
        //    $divSubmit.fadeIn('slow');/*$divFeatures.fadeIn('slow');*/});
        
        setTimeout(function(){$("li","ul.hs-error-msgs").remove()}, 10);

        $password.prop("type", "password");
        $confirm_password.prop("type", "password");

        $company.change(function() {
            var company = $(this).val();
            if(company && !$custom_url.val()){
                var url = safechar(company);
                $custom_url.val(url).change();
                ($url[0] || {}).innerText = url; 
            }
        });


        $password.change(function() {
            var password = $(this).val();
            if(password){
              if (!password.match(/^(?=(?:.*[a-z]))(?=(?:.*[!@#$%^&*-])).{5,}$/)){  
                seterror($(this), "Password must be 5-character alphanumeric with complex ($%@) symbol.");
                return;
              }
                else{
                seterror($password, "", true);
            }
            }
            else
                seterror($password, "", true);
            if ($confirm_password.val().length > 0 && $confirm_password.val() != password){ 
                seterror($confirm_password, "Passwords must match.");
                return;
            }
            else{
                seterror($confirm_password, "", true);
            }
        
        seterror($(this), "", true);
                      if ($confirm_password.val().length == 0){ 
                seterror($confirm_password, "", true);
            }
    });


        $confirm_password.focusout(function() {
            var password = $password.val();
            var confirm_password = $confirm_password.val();

            if(confirm_password == password){ 
                seterror($(this), "", true);
            }
            else if (password !=confirm_password)
                seterror($(this), "Passwords must match.");
        });


        $custom_url.change(function() {
            var url = safechar($(this).val());
            if ($(this).val() != url)
            {
                $custom_url.val(url).change();
            }
            ($url[0] || {}).innerText = url || "yourcompanyname"; 
            if (url)
            {
                if (url.length < 3 || url.length > 20)
                { 
                    seterror($(this), "This Url is incorrect. Please enter between 3 and 20 characters.");
                    return;
                }
                var xhr = new XMLHttpRequest();
                var api_url = beta ? "https://api.beta.sherpadesk.com" : "https://api.sherpadesk.com";
                xhr.open('GET', api_url + "/validate_organization?format=json&url="+url, true);
                xhr.onload = function(e) { 
                    if (e.target.status == 200)
                    {
                        var data = JSON.parse(e.target.response);
                        if (data.isUrlExists)
                        {
                            seterror($custom_url, "This Url is already in use");
                        }
                        else
                            seterror($custom_url, "", true);
                    }
                    else
                    {
                    //alert(e.target.response);
                    console.log(e);
                }
            }
            xhr.send();
        }
        else
            seterror($custom_url, "", true);
        //console.log($(this).val());
    });

            
        //$email[0].classList.contains("error")
        $email.change(function() {

            if(testpage)
             {
        if ($name.val() !=""){
                        $divCompany.fadeIn('slow');$divUrl.fadeIn('slow');$company.focus();}
               return;
             }

            var email = $(this).val();
            if(email.indexOf("@") > 0)
            {
                var xhr = new XMLHttpRequest();
                var api_url = "https://api.sherpadesk.com";
                xhr.open('GET', api_url + "/hubspot/check?email="+email+"&format=json", true);
                xhr.onload = function(e) { 
                    if (e.target.status == 200)
                    {
                        if ($name.val() !=""){
                        $divCompany.fadeIn('slow');$divUrl.fadeIn('slow');$company.focus();}
                        seterror($email, "", true);
                    }
                    else
                    {
                        seterror($email, "Your email is undeliverable. Please use a valid business email address.");
                    }
            }
            xhr.send();
        }
        //else
        //    seterror($custom_url, "", true);
    });

    }

    function onFormSubmit1($form){
        //alert("OK");
        //return;
        //console.log('$form', $form); 
            // lock down the form
    $lockModal.css("display", "block");
    $loadingCircle.css("display", "block");
    $motto.css("display", "block");

        init_vars($form);
        //seterror($submit, "Redirecting to SherpaDesk app. Please wait...");
        
            if (testpage) { $captcha.val("sdjkhaskdjhg"); }
        //console.log($captcha.val())
      
        localStorage.testpage = testpage ? 1 : "";
        
        //on test dont create organization
        if (getParameterByName("test"))
        {
          return;
        }
        
        

        var pass1 = $password.val(), 
        pass2 = $confirm_password.val();

        var referral = "";
        if ($referral.length)
            referral = $referral.val() || "";

        $password.val("").change();
        $confirm_password.val("").change();

        var formData = new FormData();

        formData.append("name", Mp_SafeCharsRemove($company.val()));
        formData.append("email", $email.val());
        formData.append("url", $custom_url.val());
        formData.append("firstname", Mp_SafeCharsRemove($name.val()));
        formData.append("lastname", " ");
        formData.append("password", pass1);
        formData.append("password_confirm", pass2);
        formData.append("techs_number", $($techs).val());
        formData.append("industry", $($industry).val());
        formData.append("how", get_how(referral));
        formData.append("iiid", iiid);
        formData.append("provider", provider);
        formData.append("note", "Industry: " + $industry.val() + " - Techs: " + $techs.val() + " url:" + location.href.substring(0,50));
        formData.append("referral", referral);

                // Append extra data before send.
                formData.append('is_force_registration', 'true'); 
                formData.append('is_force_redirect', 'true');
                formData.append("is_send_hubSpot", "false");
                
                window.onbeforeunload = function(){
                    if (res)
                      localStorage.redirect = res;
            //window.location = "https://www.sherpadesk.com/thank-you?redirect="+res;
        };

        var xhr = new XMLHttpRequest();
        var api_url = beta ? "https://api.beta.sherpadesk.com" : "https://api.sherpadesk.com";
        xhr.open('POST', api_url + "/organizations?format=json", false);
        xhr.onload = function(e) { 
            if (e.target.status == 200 || e.target.status == 201)
            {
                var data = JSON.parse(e.target.response);
                        //if (testpage)
                        //{
                            console.log(data);
                            res = encodeURIComponent(data.url);
                            localStorage.redirect = res;
                            //window.location = "https://www.sherpadesk.com/thank-you?redirect="+res;
                            //return;
                        //}
                        //window.location = data.url;
                    }
                    else
                    {
                      
                        $lockModal.css("display", "none");
                        $loadingCircle.css("display", "none");
                        $motto.css("display", "none");
                        setServererror($motto, "Error occured: " + (e.target.response || e.target.status) +". Please contact SherpaDesk administrator (support@sherpadesk.com)");
                        $custom_url.change();
                        $password.val(pass1).change();
                        $confirm_password.val(pass2).change();
                      alert("Error occured: " + (e.target.response || e.target.status) +". Please contact SherpaDesk administrator (support@sherpadesk.com)");
                      location.reload();
                        //console.log(e);
                    } 
                }
                xhr.onerror = function () {
                          $lockModal.css("display", "none");
                          $loadingCircle.css("display", "none");
                          $motto.css("display", "none");
                    console.log("** An error occurred during the transaction");
                    $password.val(pass1).change();
                    $confirm_password.val(pass2).change();
                    setServererror($motto, "Error occured. Please try again later or contact SherpaDesk administrator (support@sherpadesk.com)");
                 alert("Error occured. Please try again later or contact SherpaDesk administrator (support@sherpadesk.com)");
                  location.reload();
                };

                xhr.send(formData);
                
                setTimeout(function(){setServererror($motto, "", true)}, 10000);
            }    

        </script>
      <!-- End Signup code - DONT TOUCH! -->

<script src="https://www.google-analytics.com/analytics_debug.js"></script>