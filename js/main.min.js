function updatedFunction(){location.reload(!0)}function checkEmail(e){return null!==e.trim().match(/^[^@\s]+@[^@\s]+(\.[^@\s]+)+$/i)}function checkURL(e){return null!==e.trim().match(/(jpeg|jpg|gif|png)$/i)}function onDeviceReady(){isPhonegap=!0,cordova.plugins.notification.badge&&(localStorage.badge>0?cordova.plugins.notification.badge.set(localStorage.badge):cordova.plugins.notification.badge.clear())}function openURL(e){window.open(e,"_blank","location=no,EnableViewPortScale=yes")}function openURLsystem(e){window.open(e,"_system")}function reveal(){$("#loading").hide1()}function errorLine(e){var t="location.reload(false)";$("#scroller").hide(),$(".catch-error").length||$("body").prepend('<div class="catch-error"><div class="catch-error-description"><h2>&nbsp;</h2><h2>&nbsp;</h2><h2>Something went wrong...</h2><div id="ctl00_PageBody_StackTrace" class="return-button"><p /><p /><h4>'+e+'</h4><h4>&nbsp;<p>P.S.  Uh... a Yeti just attacked your  camp!</h4><center><button class=loginButton style="width: 200px;" onclick="'+t+'">Refresh</button></center></div></div>')}function offLine(){var e="redirectToPage()";isOnline=!1,$(".catch-error").length||$("body").prepend('<div class="catch-error"><div class="catch-error-description"><h2>&nbsp;</h2><h2>&nbsp;</h2><h2>Check your internet connection!</h2><div id="ctl00_PageBody_StackTrace" class="return-button"><p /><p /><h4>P.S.  Uh... a Yeti just attacked your  camp!</h4><center><button class=loginButton style="width: 200px;" onclick="'+e+'">Refresh</button></center></div></div>')}function onLine(){isOnline||($(".catch-error").remove(),location.reload(!1)),isOnline=!0}function redirectToPage(){if(navigator.onLine)if(isPhonegap)onLine();else{var e=document.body.appendChild(document.createElement("img"));e.style.display="none",e.onload=function(){onLine()},e.onerror=function(){offLine()},e.src=MobileSite+"img/select_arrow.png?rand="+Math.random()}else offLine()}function logout(e,t){clearStorage(),localStorage.is_google?(localStorage.removeItem("userName"),localStorage.removeItem("is_google"),GooglelogOut()):window.location="login.html"+(t?"?f="+t:"")}function GooglelogOut(e){if(e=e?"?f="+e:"",isExtension||confirm("Do you want to stay logged in Google account?"))window.location="login.html"+e;else{document.location.href=MobileSite+"login.html"+e}}function clearStorage(){var e=localStorage.userName||"",t=localStorage.appVersion||"",o=localStorage.loadTicketNumber||"";localStorage.clear(),localStorage.setItem("userName",e),localStorage.appVersion=t,localStorage.loadTicketNumber=o,isExtension&&window.top.postMessage("logout","*")}function getInfo4Extension(){if(isExtension){var e="login?t="+localStorage.getItem("userKey")+"&o="+localStorage.getItem("userOrgKey")+"&i="+localStorage.getItem("userInstanceKey");window.top.postMessage(e,"*")}}function fullapplink(){var e=AppSite+"?dept="+localStorage.getItem("userInstanceKey")+"&org="+localStorage.getItem("userOrgKey");return isPhonegap?$(".fullapplink").on("click",function(t){t.preventDefault(),openURLsystem(e)}):isExtension?$(".fullapplink").on("click",function(t){t.preventDefault();var o=window.__proto__.open;o.apply(window,[e,"_blank"])}):($(".fullapplink").attr("target","_blank"),$(".fullapplink").attr("href",e)),e}function htmlEscape(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function filterList(e,t,o){$("body").attr("id","search_wrap"),t?t&&(t=t.split(",")):t=["blockNumber","responseText","TicketBlockNumber","user_name"];var i={listClass:e,item:"item",valueNames:t};return featureList=new List("search_wrap",i),o&&(featureList.search(o),$(".search").val(o)),featureList.on("updated",function(){if(featureList.matchingItems.length>1){"There are "+featureList.matchingItems.length+" matching tickets."}else 0===featureList.matchingItems.length&&console.log("Bummer...  0 items found")}),featureList}function createSpan(e){var t=$(window).height(),o=$("#content").height();t>o+60&&(o=t-o-60,$("<p id=fill style='height:"+o+"px'>&nbsp;</p>").appendTo(e+""))}function getParameterByName(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function cleanQuerystring(){try{window.history.replaceState({},document.title,location+Page)}catch(e){}}function showError(e){var t=e.data||(((e||{}).responseJSON||{}).ResponseStatus||{}).Message;setTimeout(function(){reveal(),userMessage.showMessage(!1,t||"Error. Please contact Administrator")},2e3)}var year="2015",appVersion="25",adMessage="Add ticket time",Site="sherpadesk.com/",MobileSite="http://m."+Site,AppSite="https://app."+Site,ApiSite="http://api."+Site,Page=location.pathname.substr(1),isExtension=window.self!==window.top,updateStatusBar=navigator.userAgent.match(/iphone|ipad|ipod/i)&&parseInt(navigator.appVersion.match(/OS (\d)/)[1],10)>=7,isTech=!1,isProject=!0,isTime=!0,isAccount=!0,isLevel=!0,isClass=!0,isLocation=!0,isFreshbook=!0,isExpenses=!0,isTravelCosts=!0,isInvoice=!0,is_MultipleOrgInst=!0,formatDate=function(e){if(!e||e.length<12)return e;var t=e.substring(0,4),o=e.substring(5,7),i=e.substring(8,10);switch(o){case"01":o="Jan";break;case"02":o="Feb";break;case"03":o="Mar";break;case"04":o="Apr";break;case"05":o="May";break;case"06":o="Jun";break;case"07":o="Jul";break;case"08":o="Aug";break;case"09":o="Sep";break;case"10":o="Oct";break;case"11":o="Nov";break;case"12":o="Dec";break;default:o="nul"}return o+"&nbsp;"+i+(year!=t?"&nbsp;/&nbsp;"+t:"")};$.fn.show1=function(){this[0]&&(this[0].style.display="block")},$.fn.hide1=function(){this[0]&&(this[0].style.display="none")};var cacheName="",cacheTime=5e3,isPhonegap=!1,isOnline=!0;document.addEventListener("deviceready",onDeviceReady,!1),document.addEventListener("offline",offLine,!1),document.addEventListener("online",onLine,!1),$(document).ajaxError(function(e,t,o){(403==t.status&&o.url!==ApiSite+"organizations"||404==t.status&&o.url===ApiSite+"config")&&logout(o.url!==ApiSite+"login",t.statusText),setTimeout(function(){$("#loading").hide1(),$("body").show1(),console.log("ajaxError:"+t.statusText+" page: "+o.url),redirectToPage()},1e3)}),window.onerror=function(e,t,o,i,a){var s=i?"<p>column: "+i:"";s+=a?"<p>error: "+a:"",o>0&&setTimeout(function(){errorLine("<p onclick='$(\".err\").toggle();'>Click for Error Details:</p><div class=err style='display:none;'>"+e+"<p>page: "+location.href+"<p>url: "+t+"<p>line: "+o+s+"</div>"),$("#loading").hide1(),$("body").show1(),console.log("onerror:"+e+" page: "+location.href+" url: "+t+" line: "+o+s)},2e3);var n=!0;return n},window.onload=function(){"object"==typeof WebPullToRefresh&&WebPullToRefresh.init({loadingFunction:function(){"dash"===cacheName?(localStorage.setItem("storageQueues",""),localStorage.setItem("storageAccountList",""),localStorage.setItem("ticketsStat","")):localStorage.setItem(cacheName,""),location.reload(!1)}})};var userMessage={init:function(){this.showMessage()},setMessage:function(e,t){localStorage.setItem("userMessage",t),localStorage.setItem("isMessage",e?"truePos":"trueNeg")},showMessage:function(e,t,o){if("undefined"==typeof e){var i=localStorage.getItem("isMessage");if("truePos"==i)e=!0,localStorage.setItem("isMessage","false");else{if("trueNeg"!=i)return;e=!1,localStorage.setItem("isMessage","false")}}t||(t=localStorage.getItem("userMessage"));var a=e?".errorMessagePos":".errorMessageNeg",s=$(a);return s.length?(s.html(t),s.slideDown(100),void setTimeout(function(){s.slideUp(100),"function"==typeof o&&o()},3500)):(alert(t),void("function"==typeof o&&o()))}},FileUrlHelper={ReplaceAll:function(e,t,o){return e.split(t).join(o)},matchKey:function(e,t){for(var o in t)if(-1!=o.indexOf(e))return o;return""},addUrls:function(e,t){var o=t.length,i={};if(o){for(var a=e.match(/\[cid:[^\[\]]*]/g),s=0;o>s;s++)e=FileUrlHelper.ReplaceAll(e," "+t[s].name,FileUrlHelper.getFileLink(t[s].url)),i['"'+t[s].name.substring(0,t[s].name.lastIndexOf("."))+'"']=t[s].url;if(a)for(var n=0;n<a.length;n++){var c=a[n].slice(5,-1);c.indexOf("_link_")>=0?c=c.replace("_link_",""):(c=FileUrlHelper.matchKey(c.slice(0,-3),i),c=c&&"undefined"!=typeof i[c]?i[c]:""),c.length&&(e=FileUrlHelper.ReplaceAll(e,a[n],FileUrlHelper.getFileLink(c)))}o>1&&(e=FileUrlHelper.ReplaceAll(e,"a>,","a>")),e=FileUrlHelper.ReplaceAll(e,"a>.","a>")}return e},getFileLink:function(e){var t="";return t=checkURL(e)?'<img class="attachment" src="'+e+'">':"<img style='float:none;' src='img/file.png'>&nbsp;"+decodeURIComponent(e.split("/").slice(-1))+"<p></p>",'<p/><a class="comment_image_link"'+(isPhonegap?" href=# onclick='openURL(\""+e+"\")'>"+t+"</a>":' target="_blank" href="'+e+'">'+t+"</a>")}},featureList,featureList2,featureList3,featureList4,featureList5;$(document).ready(function(){function t(e,t,o){return u=localStorage.getItem("userKey"),c=localStorage.getItem("userOrgKey"),r=localStorage.getItem("userInstanceKey"),u&&c&&r?(o||(o="GET"),$.ajax({type:o,beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(c+"-"+r+":"+u))},url:ApiSite+e,cache:!0,data:t,dataType:"json"}).promise()):void console.log("Invalid organization!")}function o(e,t,o,i,a,s,n){if(!e||!e.length)return $(""+t).parent().hide(),0;var c,l=!1;a&&a.length>0&&(c=a.split(","),c.length>0&&(l=!0)),i=i||"",o=o||"",s=s||"",n=n||"";var r=o,u=0;for(u=0;u<e.length;u++){var d=e[u].id,g="";if(l){for(var m=c.length-1,h=0;m>h;h++)g+=" "+e[u][c[h]];var p=e[u][c[m]];g.trim()?g+=" ("+p+")":g=p}else g=e[u].name;r+="<option value="+d+">"+i+g+"</option>"}return u>0?($(""+s+r+n).appendTo(""+t),$(""+t).parent().show(),$(""+t).parent().parent().show()):$(""+t).parent().hide(),u}function i(e,t,i){return isClass?(o(e,t,i,"Class: "),void $(""+t).on("change",function(){$(".sub_class1, .sub_class2").is(":visible")&&($(".sub_class1, .sub_class2").hide(),$("#sub_class1, #sub_class2").empty());var i=$(t+" option:selected").val(),a=$.grep(e,function(e){return e.id==i});n=i,"undefined"!=typeof a[0]&&(null!==a[0].sub||a[0].sub>0)&&(o(a[0].sub,"#sub_class1","<option value="+n+">choose a sub class</option>","Sub class: "),$("select#sub_class1").on("change",function(){$(".sub_class2").is(":visible")&&($(".sub_class2").hide(),$("#sub_class2").empty());var e=$("select#sub_class1 option:selected").val(),t=$.grep(a[0].sub,function(t){return t.id==e});n=e,"undefined"!=typeof t[0]&&(t[0].sub>0||null!==t[0].sub)&&(o(t[0].sub,"#sub_class2","<option value="+n+">Sub Sub Class: ---</option>","Sub Sub Class: "),$("select#sub_class2").on("change",function(){var e=$("select#sub_class2 option:selected").val();n=e}))}))})):void $(""+t).parent().parent().hide()}function a(){if("tech"===localStorage.getItem("userRole")?isTech=!0:$(".sideNavLinks").children(":not('.user')").hide(),"false"===localStorage.getItem("projectTracking")&&(isProject=!1),"false"===localStorage.getItem("timeTracking")&&(isTime=!1,$(".time").remove()),"false"===localStorage.getItem("accountManager")&&(isAccount=!1,$("#itemAccount").hide()),"false"===localStorage.getItem("ticketLevels")&&(isLevel=!1),"false"===localStorage.getItem("classTracking")&&(isClass=!1),"false"===localStorage.getItem("locationTracking")&&(isLocation=!1),"false"===localStorage.getItem("freshbooks")&&(isFreshbook=!1),"false"===localStorage.getItem("is_invoice")&&(isInvoice=!1,$("#itemInvoice").hide(),$("#itemUnInvoice").hide()),"false"===localStorage.getItem("is_expenses")&&(isExpenses=!1,$(".expense").hide()),"false"===localStorage.getItem("is_travel_costs")&&(isTravelCosts=!1),"false"===localStorage.getItem("sd_is_MultipleOrgInst")?(is_MultipleOrgInst=!1,$("#switchOrg").hide()):$("#switchOrg").show(),fullapplink(),k.init(),v.init(),"ticket_list.html"==Page)return localStorage.DetailedAccount=localStorage.addAccountTicket="",void O.init();if("ticket_detail.html"==Page)return P.init(),h.init(),p.init(),f.init(),void S.init();if(isTech){if("dashboard.html"==Page){localStorage.DetailedAccount=localStorage.addAccountTicket="";var e=localStorage.getItem("userOrg");return e&&$("#indexTitle").html(e),D.init(),updateStatusBar&&$("#techStat").css("padding-top","20px"),N.init("#DashBoradQueues",3),isAccount&&j.init("#activeList",1),void w.init()}if("Account_List.html"==Page&&isAccount)return localStorage.DetailedAccount=localStorage.addAccountTicket="",void j.init("#fullList");if("timelog.html"==Page&&isTime)return void x.init();if("allInvoice_List.html"==Page&&isTime&&isInvoice)return void M.init();if("Queues.html"==Page)return void N.init("#queuesPage");if("queueTickets.html"==Page)return void A.init();if("closedTickets.html"==Page)return void m.init();if("addTicketTime.html"==Page&&isTime)return void b.init();var t=Page+"_ref";if(backFunction=function(){var e=localStorage.getItem(t);e?(localStorage.setItem(t,""),window.location.replace(e)):history.length<3?window.location="index.html":history.back()},localStorage.getItem(t)||localStorage.setItem(t,document.referrer||localStorage.referrer||"login.html"),"account_details.html"==Page&&isAccount)return C.init(),void m.pageChange();if("accountTimes.html"==Page&&isTime&&isAccount)return void E.init();if("Invoice_List.html"==Page&&isTime&&isInvoice)return void M.init();if("unInvoice_List.html"==Page&&isTime&&isInvoice)return void M.init("unbilled");if("invoice.html"==Page&&isTime&&isInvoice)return void L.init();if("add_time.html"==Page&&isTime)return void b.init();if("add_user.html"==Page)return void y.init();if("addExpence.html"==Page&&isExpenses)return void I.init();if("edit_time.html"==Page&&isTime)return void b.init(!0)}return"add_tickets.html"==Page?void _.init():"addTicket_V4.html"==Page?void T.init():void(window.location=isTech?"dashboard.html":"ticket_list.html")}var s=new Image;s.src=MobileSite+"img/error-background.png";var n,c="",l="",r="",u="",d={init:function(){var e=getParameterByName("t"),t=getParameterByName("e");if(e)return cleanQuerystring(),localStorage.setItem("is_google",!0),localStorage.setItem("userKey",e),localStorage.setItem("userName",t),void(window.location="org.html");var o=getParameterByName("f");o&&(cleanQuerystring(),userMessage.showMessage(!1,o)),this.login()},do_login:function(){var e=$("#userName").val(),t=$("#password").val();return""===e||""===t?void userMessage.showMessage(!1,"Please enter a valid Email or Password"):(localStorage.setItem("userName",e),void $.ajax({type:"POST",beforeSend:function(o){o.withCredentials=!0,o.setRequestHeader("Authorization","Basic "+btoa(e+":"+t))},url:ApiSite+"login",dataType:"json",success:function(t){localStorage.setItem("userKey",t.api_token),localStorage.setItem("userName",e),window.location="org.html"},complete:function(){},error:function(){e&&-1!=e.indexOf("@gmail.com")?userMessage.showMessage(!1,"Wrong Password, Google sign password is not neeeded"):(userMessage.showMessage(!1,"There was a problem with your login.  Please try again."),$("#password").val(""))}}))},login:function(){var e=localStorage.getItem("userName");null!==e&&e.length>0&&$("#userName").val(e),$("#login_signup").on("click",function(e){e.preventDefault(),document.location.href="signup.html"}),$("form.google_openid").get(0).setAttribute("action",ApiSite+"auth/auth0"),$("#sign_in_with_google").on("click",function(e){e.preventDefault(),$("form.google_openid").get(0).submit()}),$("#loginButton").click(function(){d.do_login()}),$(document).on("keypress","#password, #userName",function(e){13==e.which&&d.do_login()})}},g={init:function(){var e=localStorage.getItem("userName");null!==e&&e.length>0&&$("#email").val(e),$("#signupButton").click(function(){g.add()}),$(document).on("change","#name",function(){var e=$("#name").val();e&&$("#url").val(e.replace(/[^a-zA-Z 0-9]+|[\s]+/g,"").toLowerCase())}),$("#is_force_registration").prop("checked",!1),reveal()},add:function(){var e=$("#name").val(),t=$("#email").val(),o=$("#url").val(),i=$("#firstname").val(),a=$("#lastname").val(),s=$("#password").val(),n=$("#password_confirm").val(),c=$("#how").val();return""===e||""===t||""===o||""===i||""===a||""===s||""===n?void userMessage.showMessage(!1,"Please enter all fields!"):s!=n?void userMessage.showMessage(!1,"Passwords do not match!"):void $.ajax({type:"POST",url:ApiSite+"organizations",dataType:"json",data:{name:e,email:t,url:o,is_force_registration:$("#is_force_registration").is(":checked"),firstname:i,lastname:a,password:s,password_confirm:n,how_did_you_hear_about_us:c,note:isPhonegap?"registered by iPhone":"registered from mobile site"},success:function(e){return e.api_token?e.organization&&e.instance?(localStorage.setItem("userKey",e.api_token),localStorage.setItem("userName",t),localStorage.setItem("userOrgKey",e.organization),localStorage.setItem("userInstanceKey",e.instance),localStorage.setItem("userRole","user"),void U(e.organization,e.instance)):void(window.location="org.html"):void(window.location="login.html")},error:function(e){return 409==e.status?(userMessage.showMessage(!1,"This email is already in use. Please choose action below"),localStorage.setItem("userName",$("#email").val()),$("#is_force_registration").prop("checked",!0),$("#signupButton").before("<center><h3 style='padding-top: 10px;'>This email is already in use. Would you like to</h3> <div class=loginButton onclick='window.location = \"login.html\"'>Login</div><h3>or</h3></center>"),void $("#signupButton").text("Create New Organization")):void userMessage.showMessage(!1,e.statusText)}})}},m={init:function(){this.showClosedTickets(),this.pageChange()},pageChange:function(){$(".buttonShowClosedTickets").click(function(){window.location="closedTickets.html"})},showClosedTickets:function(){"truePos"==localStorage.getItem("isMessage")&&userMessage.showMessage(!0);var e="closed",o=localStorage.getItem(e+"tickets"),i=cacheTime;o&&(o=JSON.parse(o)),o&&0!=o.length?(O.createTicketsList(o,"#closedTickets"),filterList("closedTickets")):(console.log("could not load local data"),i=10),setTimeout(function(){t("tickets?status=closed&account="+localStorage.getItem("DetailedAccount")).then(function(t){O.createTicketsList(t,"#closedTickets",e),filterList("closedTickets")},function(e){showError(e),console.log("fail @ closed accounts tickets")})},i)}},h={init:function(){this.pick()},pick:function(){$("#pickUp").click(function(){t("tickets/"+localStorage.getItem("ticketNumber"),{action:"pickup",note_text:""},"PUT").then(function(){userMessage.showMessage(!0,'Ticket pickup was Succesfull <i class="fa fa-thumbs-o-up"></i>'),window.location="ticket_detail.html"},function(e){showError(e),console.log("fail @ pickup")})})}},p={init:function(){this.transfer()},transfer:function(){$("#transfer").click(function(){$("#loading").removeAttr("style"),$("#loading").show1(),$("#transfer").hide1(),$("#transferSelect").show1(),t("technicians?limit=200").then(function(e){var t="<option value=0 disabled selected> Choose Tech</option>";$(t).appendTo("#transferTechs");for(var o=0;o<e.length;o++){var i=e[o].id,a=e[o].firstname+" "+e[o].lastname;t="<option value="+i+">"+a+"</option>",$(t).appendTo("#transferTechs")}reveal()},function(e){showError(e),console.log("fail @ listTechs")}),$("#transferTechs").on("change",function(){var e=$("#transferTechs").val();t("tickets/"+localStorage.getItem("ticketNumber"),{action:"transfer",note_text:" ",tech_id:e,keep_attached:!1},"PUT").then(function(){location.reload(!1)},function(e){showError(e),console.log("fail @ transferTechs")})})})}},f={init:function(){this.closeIt(),this.reopenIt()},reopenIt:function(){$("#openIt").click(function(){t("tickets/"+localStorage.getItem("ticketNumber"),{status:"open",note_text:""},"PUT").then(function(){setTimeout(function(){userMessage.showMessage(!0,'Ticket has been Reopened <i class="fa fa-thumbs-o-up"></i>'),window.history.back()},1e3)},function(e){showError(e),console.log("fail @ ticketNumber")})})},close:function(e){return e=htmlEscape(e).trim(),e.length<2?void userMessage.showMessage(!1,"Note cannot be empty!"):e.length>5e3?void userMessage.showMessage(!1,"Note cannot be more than 5000 chars!"):void t("tickets/"+localStorage.getItem("ticketNumber"),{status:"closed",note_text:e,is_send_notifications:!0,resolved:!0,dataType:"json",confirmed:!1,confirm_note:""},"PUT").then(function(){setTimeout(function(){userMessage.showMessage(!0,'Ticket has been closed <i class="fa fa-thumbs-o-up"></i>'),window.history.back()},1e3),userMessage.setMessage(!0,"Ticket was Closed <i class='fa fa-thumbs-o-up'></i>")},function(e){showError(e),console.log("fail @ ticket Number")})},closeIt:function(){$("#closeIt").click(function(){$("#closingMessage").slideDown(400,function(){$("#closeMessageButton").fadeIn(),$("html,body").animate({scrollTop:$("#closeMessageButton").offset().top},400)})}),$("#closeMessageButton").click(function(){f.close($("#closingMessage").val())}),$("#closeu").click(function(){f.close($("#commentText").val())})}},v={init:function(){this.logOut()},logOut:function(){$("#signOut").click(logout)}},k={init:function(){this.changeOrg()},changeOrg:function(){is_MultipleOrgInst&&$("#switchOrg").click(function(){var e=localStorage.appVersion||"",t=localStorage.userKey||"",o=localStorage.userName||"";localStorage.clear(),localStorage.userName=o,localStorage.userKey=t,localStorage.appVersion=e,window.location="org.html"})}},_={init:function(){isTech&&($("#loading").show(),$("#userCreate").on("click",function(){var e=$("#addTicketUser").val();e&&localStorage.setItem("add_user_userid",e);var t=$("#addTicketTechs").val();t&&localStorage.setItem("add_user_techid",t);var o=$("#addTicketAccounts").val();o&&localStorage.setItem("add_user_accountid",o),window.location="add_user.html"}),$("#TechCreate").on("click",function(){localStorage.setItem("add_user_type","tech");var e=$("#addTicketUser").val();e&&localStorage.setItem("add_user_userid",e);var t=$("#addTicketTechs").val();t&&localStorage.setItem("add_user_techid",t);var o=$("#addTicketAccounts").val();o&&localStorage.setItem("add_user_accountid",o),window.location="add_user.html"})),this.addTicket()},addTicket:function(){$("#addTicketAccounts").empty();var e=localStorage.getItem("addAccountTicket");if(localStorage.setItem("addAccountTicket",""),isTech){if(isAccount){var a=t("accounts?limit=300",{is_with_statistics:!1});a.then(function(t){$("#addTicketAccounts").empty(),o(t,"#addTicketAccounts","<option value=0 disabled selected>choose an account</option>");var i=localStorage.getItem("add_user_accountid");e=e?e:i,e&&(localStorage.setItem("add_user_accountid",""),$("#addTicketAccounts").val(e)),reveal()},function(e){showError(e),console.log("fail @ ticket accounts")})}else $("#addTicketAccounts").parent().hide1(),reveal();var s=localStorage.getItem("add_user_userid");s?localStorage.setItem("add_user_userid",""):s=localStorage.getItem("userId");var c=localStorage.getItem("add_user_name");c?localStorage.setItem("add_user_name",""):c=localStorage.getItem("userFullName"),c.trim()||(c=localStorage.getItem("userName"));var l=t("users?limit=2000");l.then(function(e){o(e,"#addTicketUser","","","firstname,lastname,email"),$("#addTicketUser").val(s)},function(e){showError(e),console.log("fail @ TicketUser")});var r=t("technicians?limit=200");r.then(function(e){o(e,"#addTicketTechs","<option value=0 disabled selected>choose a tech</option>","","firstname,lastname,email");var t=localStorage.getItem("add_user_techid");t&&(localStorage.setItem("add_user_techid",""),$("#addTicketTechs").val(t))},function(e){showError(e),console.log("fail @ Ticket Techs")});var u=t("classes");u.done(function(e){i(e,"#classTicketOptions","<option value=0 disabled selected>choose a class</option>")})}else $("#istech").hide1();$("#submitNewTicket").click(function(){var e=htmlEscape($("#addTicketSubject").val().trim()),o=htmlEscape($("#addTicketInitPost").val().trim());if(""===e||""===$("#addTicketTechs").val()||1>n)userMessage.showMessage(!1,"Please enter subject");else if(e.length>100)userMessage.showMessage(!1,"Subject should be less 100 chars!");else if(o.length>5e3)userMessage.showMessage(!1,"Details cannot be more than 5000 chars!");else{var i=t("tickets",{status:"open",subject:e,initial_post:o,class_id:n,account_id:$("#addTicketAccounts").val(),user_id:isTech?$("#addTicketUser").val():localStorage.getItem("userId"),tech_id:$("#addTicketTechs").val()},"POST");i.then(function(){isTech?setTimeout(backFunction,1e3):location.replace("ticket_list.html"),userMessage.setMessage(!0,"Ticket was Succesfully Created :)")},function(e){showError(e),console.log("fail @ tickets")})}})}},T={init:function(){isTech&&($("#userCreate").on("click",function(){var e=$("#addTicketUser").val();e&&localStorage.setItem("add_user_userid",e);var t=$("#addTicketTechs").val();t&&localStorage.setItem("add_user_techid",t);var o=$("#addTicketAccounts").val();o&&localStorage.setItem("add_user_accountid",o),window.location="add_user.html"}),$("#TechCreate").on("click",function(){localStorage.setItem("add_user_type","tech");var e=$("#addTicketUser").val();e&&localStorage.setItem("add_user_userid",e);var t=$("#addTicketTechs").val();t&&localStorage.setItem("add_user_techid",t);var o=$("#addTicketAccounts").val();o&&localStorage.setItem("add_user_accountid",o),window.location="add_user.html"})),this.addTicket()},addTicket:function(){$("#addTicketAccounts").empty();var e=localStorage.getItem("addAccountTicket");if(localStorage.setItem("addAccountTicket",""),isTech){if(isAccount){var a=t("accounts?limit=300",{is_with_statistics:!1});a.then(function(t){$("#addTicketAccounts").empty(),o(t,"#addTicketAccounts","<option value=0 disabled selected>choose an account</option>");var i=localStorage.getItem("add_user_accountid");e=e?e:i,e&&(localStorage.setItem("add_user_accountid",""),$("#addTicketAccounts").val(e)),reveal()},function(e){showError(e),console.log("fail @ ticket accounts")})}else $("#addTicketAccounts").parent().hide1(),reveal();var s=localStorage.getItem("add_user_userid");s?localStorage.setItem("add_user_userid",""):s=localStorage.getItem("userId");var c=localStorage.getItem("add_user_name");c?localStorage.setItem("add_user_name",""):c=localStorage.getItem("userFullName"),c.trim()||(c=localStorage.getItem("userName")),$("#addTicketUser").append("<option value="+s+" selected>"+c+"</option>");var l=t("users?limit=2000");l.then(function(e){o(e,"#addTicketUser","","","firstname,lastname,email"),$("#addTicketUser").val(s)},function(e){showError(e),console.log("fail @ TicketUser")});var r=t("technicians?limit=200");if(r.then(function(e){o(e,"#addTicketTechs","<option value=0 disabled selected>choose a tech</option>","","firstname,lastname,email"),o(e,"#addTicketAltTechs","<option value=0 disabled selected>choose alt tech</option>","","firstname,lastname,email");var t=localStorage.getItem("add_user_techid");t&&(localStorage.setItem("add_user_techid",""),$("#addTicketTechs").val(t))},function(e){showError(e),console.log("fail @ Ticket Techs")}),isProject){var u=t("projects");u.done(function(e){o(e,"#ticketProject","<option value='null' disabled selected>Project</option>")})}else $("#project").hide();var d=t("priorities");$("#ticketPriority").empty(),d.done(function(e){for(var t="",o=0;o<e.length;o++)t+="<option value="+e[o].id+">Priority: "+e[o].priority_level+" - "+e[o].name+"</option>";$(t).appendTo("#ticketPriority")});var g=t("classes");g.done(function(e){i(e,"#classTicketOptions","")});var m=t("locations");m.done(function(e){o(e,"#ticketLocation","")}),$("#ticketLevel").empty(),isLevel?t("levels").done(function(e){o(e,"#ticketLevel","","Level: ")}):$("#ticketLevel").parent().hide()}else $("#istech").hide1();$("#submitNewTicket").click(function(){var e=htmlEscape($("#addTicketSubject").val().trim()),o=htmlEscape($("#addTicketInitPost").val().trim());if(""===e||""===$("#addTicketTechs").val()||1>n)userMessage.showMessage(!1,"Please enter subject");else if(e.length>100)userMessage.showMessage(!1,"Subject should be less 100 chars!");else if(o.length>5e3)userMessage.showMessage(!1,"Details cannot be more than 5000 chars!");else{var i=t("tickets",{status:"open",subject:e,initial_post:o,class_id:n,account_id:$("#addTicketAccounts").val(),location_id:$("#ticketLocation").val(),project_id:$("#ticketProject").val(),level:$("#ticketLevel").val(),priority_id:$("#ticketPriority").val(),user_id:isTech?$("#addTicketUser").val():localStorage.getItem("userId"),tech_id:$("#addTicketTechs").val()},"POST");i.then(function(){isTech?setTimeout(backFunction,1e3):m.replace("ticket_list.html"),userMessage.setMessage(!0,"Ticket was Succesfully Created :)")},function(e){showError(e),console.log("fail @ tickets")})}})}},S={init:function(){this.sendComment()},sendComment:function(){$("#reply").click(function(){var e=htmlEscape($("#commentText").val().trim());return e?e.length>5e3?void userMessage.showMessage(!1,"Note cannot be more than 5000 chars!"):void t("tickets/"+localStorage.getItem("ticketNumber"),{note_text:e,action:"response"},"POST").then(function(){location.reload(!1)},function(e){showError(e),console.log("fail @ ticket Number")}):void userMessage.showMessage(!1,"Please enter note")})}},w={init:function(){this.universalSearch()},universalSearch:function(){$(document).on("keypress","#searchThis",function(e){if(13==e.which){var t=$(".headerSearch").val().toLowerCase();return void(isNaN(t)?(localStorage.setItem("searchItem",t),localStorage.setItem("ticketPage","allTickets"),window.location="ticket_list.html"):(localStorage.setItem("ticketNumber",t),window.location="ticket_detail.html"))}})}},I={init:function(){this.addExpence(getParameterByName("ticket"))},addExpence:function(e){var o=localStorage.DetailedAccount?localStorage.DetailedAccount:-1,i=0;if(!isAccount||e?($("#timeAccounts").parent().hide(),reveal()):t("accounts?limit=300",{is_with_statistics:!1}).then(function(e){for(var t="<option value=0>choose an account</option>",i=0;i<e.length;i++)t+="<option value="+e[i].id+">"+e[i].name+"</option>";$("#timeAccounts").html(t),o&&$("#timeAccounts").val(o),$("#timeAccounts").on("change",function(){b.chooseProjects(0,0,0)}),reveal()},function(e){showError(e),console.log("fail @ time Accounts")}),!isProject||e)$("#timeProjects").parent().hide(),reveal();else{var a="<option value=0>choose a project</option>";$(a).appendTo("#timeProjects"),b.chooseProjects(o,i,0)}$("#addexpenseButton").click(function(){var o=$("#expenseAmount").val();if(!o)return void userMessage.showMessage(!1,"Please enter amount");var i=htmlEscape($("#expenseNote").val()).trim();return i.length<1?void userMessage.showMessage(!1,"Please enter note"):void t("expenses",{ticket_key:e?e:null,account_id:e?null:$("#timeAccounts").val(),project_id:e?null:$("#timeProjects").val(),tech_id:localStorage.getItem("user_id"),note:i,note_internal:$("#expenseInternal").val(),amount:o,is_billable:$(".innerCircle").hasClass("billFill"),vendor:$("#vendor").val()},"POST").then(function(){localStorage.setItem("isMessage","truePos"),localStorage.setItem("userMessage",'Expense was successfully added <i class="fa fa-money"></i>'),backFunction()},function(e){showError(e),console.log("fail @ pickup")})})}},y={init:function(){$(".innerCircle").click(function(){$(".innerCircle").hasClass("billFill")?($("#addTicketPassword").hide(),$("#addTicketConfirmPassword").hide()):($("#addTicketPassword").show(),$("#addTicketConfirmPassword").show())});var e=localStorage.getItem("add_user_type");localStorage.setItem("add_user_type",""),"tech"==e?($(".SherpaDesk").text("Add New Tech"),$(".greenButton").text("Add New Tech"),e="Tech"):e="User",$("#submitNewUser").click(function(){var o=$("#addTicketEmail").val().trim();if(o.length<1)return void userMessage.showMessage(!1,"Please enter email");if(!checkEmail(o))return void userMessage.showMessage(!1,"Please correct email");var i=$("#addTicketFirstname").val().trim();return i.length<1?void userMessage.showMessage(!1,"Please enter Firstname"):(Lastname=$("#addTicketLastname").val().trim(),Lastname.length<1?void userMessage.showMessage(!1,"Please enter Lastname"):void t("users",{Lastname:Lastname,Firstname:i,email:o,role:e},"POST").then(function(t){userMessage.showMessage(!0,e+' was created <i class="fa fa-thumbs-o-up"></i>',function(){localStorage.setItem("add_user_name",""),"Tech"==e?localStorage.setItem("add_user_techid",t.id):(localStorage.setItem("add_user_userid",t.id),localStorage.setItem("add_user_name",i+" "+Lastname)),backFunction()
})},function(e){showError(e),console.log("fail @ pickup")}))})}},b={init:function(e){this.addpicker(),$("#loading").show(),this.inputTime(e)},addpicker:function(){jQuery("#date_start").datetimepicker({mask:!1,step:5,onShow:function(){var e,t=jQuery("#date_end").val();t&&(e=new Date(t),e.setDate(e.getDate())),this.setOptions({maxDate:t?e:!1})}}),jQuery("#date_end").datetimepicker({mask:!1,step:5,onShow:function(){var e,t=jQuery("#date_start").val();t&&(e=new Date(t),e.setDate(e.getDate())),this.setOptions({minDate:t?e:!1})}})},getTaskTypes:function(e,i){i=i||0,$("#taskTypes").empty(),$("<option value=0>choose a task type</option>").appendTo("#taskTypes");var a=t("task_types",e);a.then(function(e){$("#taskTypes").empty(),o(e,"#taskTypes","<option value=0>choose a task type</option>"),i>0&&$("#taskTypes").val(i),$("#timeTicket").length||reveal()},function(e){showError(e),console.log("fail @ task Types")})},chooseProjects:function(e,i,a){"undefined"==typeof e&&(e=-1),i=i||0,a=a||0,e||(e=isAccount?$("#timeAccounts").val():-1),isProject?($("#timeProjects").empty(),$("<option value=0>choose a project</option>").appendTo("#timeProjects"),"0"!==e?($("#loading").fadeIn(),t("accounts/"+e,{is_with_statistics:!1}).then(function(t){o(t.projects,"#timeProjects"),$("#timeProjects").val(i),b.getTaskTypes({account:e,project:i},a),b.chooseTickets(e,i,0)},function(e){showError(e),console.log("fail @ time Projects")})):$("#timeProjects").parent().show()):(b.getTaskTypes({account:e},a),b.chooseTickets(e,i,0))},chooseTickets:function(e,o,i){$("#timeTicket").length&&("undefined"==typeof e&&(e=-1),o=o||0,i=i||0,e||(e=isAccount?$("#timeAccounts").val():-1),$("#timeTicket").empty(),$("#loading").fadeIn(),t("tickets?status=open&limit=100&account="+e+"&project="+o).then(function(e){var t=e.length;if(0>=t)$("<option value= disabled>no open tickets found</option>").appendTo("#timeTicket");else{for(var o="<option value=>choose a ticket</option>",i=0;t>i;i++)o+="<option value="+e[i].number+">#"+e[i].number+"&nbsp;:&nbsp;"+e[i].subject+"</option>";$(o).appendTo("#timeTicket")}setTimeout(reveal,500)},function(e){showError(e),console.log("fail @ time Projects")}))},inputTime:function(o){{var i=!0;(new Date).toJSON().slice(0,10)}if($("#submitTicketTime").click(function(){var e=$("#addTimeTicket").val(),o=htmlEscape($("#noteTimeTicket").val().trim()),a=localStorage.getItem("techId"),s=$("#taskTypes").val(),n=localStorage.getItem("ticketNumber");if(o.length<1)return void userMessage.showMessage(!1,"Please enter note");if(o.length>5e3)return void userMessage.showMessage(!1,"Note cannot be more than 5000 chars!");if("0"==s)return void userMessage.showMessage(!1,"Choose a tasktype");if(0>=e)return void userMessage.showMessage(!1,"Oops not enough time");i=$(".innerCircle").hasClass("billFill")?!0:!1;var c,l=jQuery("#date_start").val();l&&(c=JSON.stringify(new Date(l)));var r,u=jQuery("#date_end").val();u&&(r=JSON.stringify(new Date(u))),t("time",{ticket_key:n,note_text:o,task_type_id:s,hours:e,is_billable:i,date:l?c:"",start_date:l?c:"",stop_date:u?r:"",tech_id:a},"POST").then(function(){localStorage.setItem("isMessage","truePos"),localStorage.setItem("userMessage",'Time was successfully added <i class="fa fa-thumbs-o-up"></i>'),window.location.replace("ticket_detail.html")},function(e){showError(e),console.log("fail @ pickup")})}),$("#submitTicketTime").length)b.getTaskTypes({ticket:localStorage.getItem("ticketNumber")},0);else{var a=0,s=localStorage.getItem("timeNumber");o&&s?(a=JSON.parse(s),a.billable||$(".innerCircle").removeClass("billFill"),$("#noteTime").val(a.note),$("#addTimeTicket").val(a.hours||0),$(".title").html("Time #"+a.time_id+" by "+a.user_name+" @ "+new Date(a.date).dateFormat("Y/m/d H:i")),a.start_time&&$("#date_start").val(new Date(a.start_time).dateFormat("Y/m/d H:i")),a.stop_time&&$("#date_end").val(new Date(a.stop_time).dateFormat("Y/m/d H:i"))):$("#timeTicket").parent().show1();var n=localStorage.DetailedAccount||-1,c=0,l=0,r="";if(a&&(n=a.account_id,c=a.project_id,l=a.task_type_id,r=a.ticket_number),isAccount?(t("accounts?limit=300",{is_with_statistics:!1}).then(function(e){$("#timeAccounts").empty();var t="<option value=0>choose an account</option>";$(t).appendTo("#timeAccounts");for(var o="",i=0;i<e.length;i++)o+="<option value="+e[i].id+">"+e[i].name+"</option>";$(o).appendTo("#timeAccounts"),$("#timeAccounts").val(n)},function(){showError(e),console.log("fail @ time accounts")}),$("#timeAccounts").on("change",function(){b.chooseProjects(0,c,l)})):$("#timeAccounts").parent().hide1(),isProject){var u="<option value=0>choose a project</option>";$(u).appendTo("#timeProjects"),b.chooseProjects(n,c,l),$("#timeProjects").on("change",function(){var e=isAccount?$("#timeAccounts").val():-1,t=$("#timeProjects").val();b.getTaskTypes({account:e,project:t},l),b.chooseTickets(e,t,0)}),reveal()}else $("#timeProjects").parent().hide1();$("#taskTypes").empty(),$("<option value=0>choose a task type</option>").appendTo("#taskTypes"),isAccount&&isProject||(b.getTaskTypes({account:n,project:c},l),b.chooseTickets(n,c,r)),$("#submitTime").click(function(){var e=$("#addTimeTicket").val(),s=htmlEscape($("#noteTime").val().trim()),n=localStorage.getItem("userId"),c=$("#timeAccounts").val(),l=$("#timeProjects").val(),u=$("#taskTypes").val();i=$(".innerCircle").hasClass("billFill")?!0:!1;var d,g=jQuery("#date_start").val();g&&(d=JSON.stringify(new Date(g)));var m,h=jQuery("#date_end").val();return h&&(m=JSON.stringify(new Date(h))),0>=e?void userMessage.showMessage(!1,"Oops not enough time"):"0"==c&&isAccount?void userMessage.showMessage(!1,"Choose an account"):"0"==u?void userMessage.showMessage(!1,"Choose a tasktype"):0==s.length?void userMessage.showMessage(!1,"Enter note"):(r=r||$("#timeTicket").val(),void t("time"+(o?"/"+a.time_id:""),{tech_id:o?a.user_id:n,project_id:l,is_project_log:!r,ticket_key:r,account_id:c,note_text:s,task_type_id:u,hours:e,is_billable:i,date:g?d:"",start_date:g?d:"",stop_date:h?m:""},o?"PUT":"POST").then(function(){localStorage.setItem("isMessage","truePos"),localStorage.setItem("userMessage",'Time was successfully added <i class="fa fa-thumbs-o-up"></i>'),backFunction()},function(e){showError(e),console.log("fail @ pickup")}))})}}},P={init:function(){isTech?$("#closeu").hide():($(".tabs").hide(),$("#closeu").show()),this.showTicket(),this.updateTicket()},updateTicket:function(){$(".updateButton").click(function(){var e=n,o=$("#ticketLevel").val(),i=$("#ticketPriority").val(),a=$("#ticketProject").val(),s={class_id:e,level_id:o,priority_id:i,project_id:a};t("tickets/"+localStorage.getItem("ticketId"),s,"PUT").then(function(){console.log("Then Complete"),userMessage.setMessage(!0,"Ticket was successfully updated <i class='fa fa-thumbs-o-up'></i>"),window.location="ticket_detail.html",userMessage.showMessage(!0)})})},showTicket:function(){"truePos"==localStorage.getItem("isMessage")&&userMessage.showMessage(!0),$("html,body").css("scrollTop","0"),t("tickets/"+localStorage.getItem("ticketNumber")).then(function(e){var a=e.daysold_in_minutes/-60;localStorage.setItem("techId",e.tech_id),localStorage.setItem("ticketId",e.id),$("#ticketExpense").attr("href","addExpence.html?ticket="+e.id),a=a>24?parseInt(a/24)+" days ago":parseInt(a)+" hours ago","Closed"==e.status?($("#closeIt").hide(),$("#closeu").hide()):$("#openIt").hide();var s=e.total_hours;$("#ticketNumber").html(e.status+" | "+e.number),$("#ticketSubject").html(e.subject),$("#ticketClass").html(e.class_name),$("#ticketTech").html(e.tech_firstname),$("#lastUpdate").html(a),e.misc_cost?$("#expenses").html("Expenses: "+localStorage.currency+Number(e.misc_cost).toFixed(2).toString()):$("#expenses").hide(),0!==s?$("#ticketHours").html(s+" Hours"):$("#ticketHours").hide(),null===e.sla_complete_date?$("#ticketSLA").hide():$("#ticketSLA").html("SLA: "+e.sla_complete_date.toString().substring(0,10));var c=e.tech_email;c==localStorage.getItem("userName")&&$("#pickUp").hide();var l=t("classes"),r=t("priorities");$("#ticketLevel").empty(),isLevel?t("levels").done(function(t){o(t,"#ticketLevel","","Level: ")>0&&$("#ticketLevel").val(e.level)}):$("#ticketLevel").parent().hide(),$("#classOptions").empty(),l.done(function(t){n=e.class_id,i(t,"#classOptions","<option data-classId="+e.class_id+" value="+e.class_id+">Class: "+e.class_name+"</option>")}),$("#ticketPriority").empty(),r.done(function(t){for(var o="",i=0;i<t.length;i++)o+="<option value="+t[i].id+">Priority: "+t[i].priority_level+" - "+t[i].name+"</option>";$(o).appendTo("#ticketPriority"),$("#ticketPriority").val(e.priority_id)}),$("#ticketTechs").empty();for(var u="",d=0;d<e.technicians.length;d++)u+="<option value="+e.technicians[d].user_id+">"+e.technicians[d].user_fullname+"</option>";if($(u).appendTo("#ticketTechs"),$("#location").remove(),isProject){var g=t("projects");g.done(function(t){o(t,"#ticketProject",""==e.project_name?"<option value='null' disabled selected>Project</option>":"")>0&&""!=e.project_name&&$("#ticketProject").val(e.project_id)})}else $("#project").hide();var m=e.ticketlogs.length,h=e.attachments||[];h.sort(function(e,t){return t.name.length-e.name.length}),$(".orginalMessageContainer").empty(),P.createLogs([e.ticketlogs.shift()],".orginalMessageContainer",h),m>1&&($("#comments").empty(),P.createLogs(e.ticketlogs,"#comments",h)),reveal()},function(){console.log("fail @ Ticket Detail"),userMessage.showMessage(!1,"No ticket found. Going back to a list."),setTimeout(function(){history.length<3?window.location="ticket_list.html":history.back()},4e3)})},createLogs:function(e,t,o){for(var i=e.length,a=[],s=$(t),n=0;i>n;n++){var c=$.md5(e[n].user_email),l=e[n].log_type,r=e[n].user_firstname+" "+e[n].user_lastname,u=e[n].note,d=formatDate(e[n].record_date);a[n]="<ul class='commentBlock'><li><img src='http://www.gravatar.com/avatar/"+c+"?d=mm&s=80' class='commentImg'></li><li class='commentText'><h3 class=dots>"+r+"</h3></li><li><span>"+d+"</span></li><li class='commentText'><p>"+$("<span />",{html:u.replace(/<br\s*[\/]?>/gi,"\n")}).text().replace(/\n/g,"<p></p>")+"</p></li><li>"+l+"</li></ul>"}var g=FileUrlHelper.addUrls(a.join(""),o);s.html(g)}},L={init:function(){$("#loading").show1(),this.specifics()},specifics:function(){var e=localStorage.invoiceNumber;e||backFunction(),-1!=e.indexOf(",")?($("#sendInvoiceButton").html("Create Invoice"),$("#invoiceNumber").html("Create Invoice"),e=e.split(","),e="?status=unbilled&account="+e[0]+"&project="+e[1]):e="/"+e;var o,i;t("invoices"+e).then(function(e){localStorage.setItem("invoiceAccountId",e.account_id),localStorage.setItem("invoiceProjectId",e.project_id),o=e.start_date||(new Date).toJSON(),i=e.end_date||(new Date).toJSON(),$("#invoiceNumber").html(e.id?"Invoice  #"+e.id:"Create Invoice");var t=e.customer;$("#customerName").html(t);var a=(o!=i?formatDate(o)+"&nbsp;-&nbsp;":"")+formatDate(i);$("#invoiceDate").html(a),$("#invoiceHours").html(e.total_hours.toFixed(2)+"<span class='detail3Small'>hrs</span>");var s=e.amount.toFixed(2).toString().split(".");if($("#invoiceAmount").html(localStorage.getItem("currency")+s[0]+"<span class='detail3Small'>."+s[1]+"</span>"),isTravelCosts?(s=e.travel_cost.toFixed(2).toString().split("."),$("#invoiceTravel").html(localStorage.getItem("currency")+s[0]+"<span class='detail3Small'>."+s[1]+"</span>")):$("#invoiceTravel").parent().parent().hide(),isExpenses){var n=e.misc_cost.toFixed(2).toString().split(".");$("#invoiceExpenses").html(localStorage.getItem("currency")+n[0]+"<span class='detail3Small'>."+n[1]+"</span>")}else $("#invoiceExpenses").parent().parent().hide();$("#invoiceAdjustments").html(localStorage.getItem("currency")+"0<span class='detail3Small'>.00</span>"),s=Number(e.total_cost).toFixed(2).toString().split("."),$(".invoiceTotal").html(localStorage.getItem("currency")+s[0]+"<span class='detail3Small'>."+s[1]+"</span>"),$("#recipientList").empty();var c="",l=e.recipients,r=e.recipients.length;if(r>0){l.sort(function(e,t){return e.is_accounting_contact<t.is_accounting_contact?1:-1});for(var u=0;r>u;u++){var d=$.md5(l[u].email);c+="<li class=recipientParent><ul class='recipientDetail'><li><img src='http://www.gravatar.com/avatar/"+d+"?d=mm&s=80'></li><li><div class='recipient dots'><p>"+l[u].email+"</p>"+(l[u].is_accounting_contact?"<img class='plusIcon' id=\""+l[u].email+"\"  src='img/check.png'> ":'<img class=closeIcon id="'+l[u].email+"\" src='img/error.png'>")+"</div></li></ul></li>"}$("#recipientList").html(c)}else $("<li><h3 class=noDataMessage>No accounting contacts found.<p>&nbsp;</p></h3></li>").appendTo("#recipientList"),$("#sendInvoiceButton").remove();reveal()},function(e){showError(e),console.log("fail @ Invoice details")}),$("#sendInvoiceButton").click(function(){if($(".recipient").children(".plusIcon").length<1)return void userMessage.showMessage(!1,"No accounting contacts selected");var e="";$.each($(".recipient").children(".plusIcon"),function(){e+=$(this).attr("id")+","});var a,s=localStorage.invoiceNumber,n=-1!=s.indexOf(",");n?(s=s.split(","),a={status:"unbilled",account:s[0],project:s[1],start_date:o,end_date:i},s="invoices"):(a={action:"sendEmail"},s="invoices/"+s),a.recipients=e,t(s,a,n?"POST":"PUT").then(function(){setTimeout(function(){backFunction()},1e3),userMessage.setMessage(!0,"Hurray! Invoice sent")},function(e){showError(e),console.log("fail @ storage Account List")})})}},M={init:function(e){$("#loading").show1();var t=localStorage.DetailedAccount;e||$("#invoiceCreate").click(function(){window.location.replace("unInvoice_List.html")}),this.listInvoices(t,e)},listInvoices:function(e,o){$(document).on("click",".invoiceRows",function(){localStorage.setItem("invoiceNumber",$(this).attr("data-id")),window.location="invoice.html"});t("invoices",{status:o,account:e}).then(function(e){if($("#invoiceList").empty(),0==e.length)return $('<h3 class="noDataMessage">no invoices at this time</h3>').prependTo("#invoiceList"),createSpan("#invoiceList"),void reveal();"undefined"==typeof e.length&&(e=[e]);for(var t="",i=0;i<e.length;i++){var a=e[i].customer,s=formatDate(e[i].end_date||e[i].date||(new Date).toJSON());n=e[i].account_id+","+e[i].project_id;var n=o?e[i].account_id+","+e[i].project_id:e[i].id;t+="<ul data-id="+n+" class='invoiceRows item'><li class='user_name dots'>"+a+"</li><li class=responseText>"+s+"</li><li>$"+Number(e[i].total_cost).toFixed(2)+"</li></ul>"}$(t).appendTo("#invoiceList"),createSpan("#invoiceList"),reveal(),filterList("tabpageContainer")},function(e){showError(e),console.log("fail @ invoice List")})}},A={init:function(){$(".title").html("Tickets @ "+localStorage.getItem("currentQueueName")+" Queue"),this.queueTickets(),$("#ticketCreate").click(function(){localStorage.setItem("add_user_techid",localStorage.getItem("currentQueue")),localStorage.setItem("add_user_accountid",account),window.location.replace("add_tickets.html")})},queueTickets:function(){var e=localStorage.getItem("currentQueue");e||(console.log("fail @ Queues tickets"),window.history.back()),t("queues/"+e).then(function(t){O.createTicketsList(t,"#queueTickets"),filterList("queueTickets"),reveal();var o=localStorage.getItem("storageQueues");o&&(match=new RegExp('"'+e+",(\\d+)").exec(o),match&&(o=JSON.parse(o),o[Number(match[1])].tickets_count=t.length,localStorage.setItem("storageQueues",JSON.stringify(o))))},function(e){showError(e),console.log("fail @ queue Tickets")})}},N={init:function(e,t){$(document).on("click","#queue",function(){localStorage.setItem("currentQueue",$(this).attr("data-id")),localStorage.setItem("currentQueueName",$(this).find(".OptionTitle").text()),window.location="queueTickets.html"}),cacheName="storageQueues",N.queues(t,e)},queues:function(e,o){var i=localStorage.getItem("storageQueues"),a=cacheTime;i&&(i=JSON.parse(i)),i&&0!=i.length?(N.createQueuesList(o,i,e),e||createSpan(o)):(console.log("could not load local data"),a=10),setTimeout(function(){t("queues",{sort_by:"tickets_count"}).then(function(t){N.createQueuesList(o,t,e),localStorage.setItem("storageQueues",JSON.stringify(t)),reveal(),e||(createSpan(o),filterList("OptionsList"))},function(e){showError(e),console.log("fail @ Queues List")})},a)},createQueuesList:function(e,t,o){for(var i=0,a=0,s=[],n=t.length,c=$(e),l=0;n>l;l+=1)0==t[l].fullname.toLowerCase().indexOf("new ticket")&&(i=t[l].tickets_count),t[l].index=t[l].id+","+l,o&&t[l].tickets_count<1||o&&a>=o||(s.push("<li class=item><div id='queue' data-id="+t[l].id+" class='OptionWrapper'><h3 class='OptionTitle dots user_name'>"+t[l].fullname+"</h3></div><div class='NotificationWrapper'><h2>"+t[l].tickets_count+"</h2></div></li>"),n>10&&10==l&&c.html(s.join("")),a+=1);c.html(s.join("")),localStorage.badge=i}},O={init:function(){if(isTech){var e=localStorage.getItem("searchItem");localStorage.setItem("searchItem",""),this.userTickets(e),this.techTickets(e),this.altTickets(e),this.allTickets(e)}else this.userTickets(),$("#userContainer").css("padding-top","20px"),$("#tabpage_reply").fadeIn()},createTicketsList:function(e,t,o){$(document).on("click",".responseBlock",function(){localStorage.setItem("ticketNumber",$(this).attr("data-id")),window.location="ticket_detail.html"});var i=$(t);if(i.empty(),!e||e.length<1)i.html('<h1 class="noTicketMessage">No Tickets</h1>');else{for(var a=[],s=e.length,n=0;s>n;n+=1){var c=$.md5(e[n].user_email),l=e[n].initial_post,r=e[n].subject;e[n].index=e[n].key+","+n;var u=e[n].key,d=e[n].is_new_tech_post&&e[n].technician_email!=localStorage.userName||e[n].is_new_user_post&&e[n].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";l.length>400&&(l=l.substring(0,400)+"..."),l=$("<span />",{html:l.replace(/<br\s*[\/]?>/gi,"\n")}).text(),a.push("<ul class='responseBlock item' id='thisBlock' data-id="+u+"><li><p class='blockNumber numberStyle'>#"+e[n].number+"</p><img src='http://www.gravatar.com/avatar/"+c+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[n].user_firstname+"</span></li><li class='responseText'><h4 class=dots>"+d+r+"</h4><p class ='initailPost'>"+l+"</p></li><li><p class='TicketBlockNumber'>"+e[n].class_name+"</p></li></ul>"),s>10&&10==n&&(i.html(a.join("")),a=[])}i.append(a.join("")),createSpan(t),o&&localStorage.setItem(o+"tickets",JSON.stringify(e))}},techTickets:function(e){var o="tech",i=localStorage.getItem(o+"tickets"),a=cacheTime;i&&(i=JSON.parse(i)),i&&0!=i.length?(O.createTicketsList(i,"#techContainer"),featureList2=filterList("techContainer","",e)):(console.log("could not load local data"),a=10),setTimeout(function(){t("tickets?status=open&limit=100&role=tech").then(function(t){O.createTicketsList(t,"#techContainer",o),featureList2=filterList("techContainer","",e)},function(e){showError(e),console.log("fail @ tech Container")})},a)},allTickets:function(e){var o="all",i=localStorage.getItem(o+"tickets"),a=cacheTime;i&&(i=JSON.parse(i)),i&&0!=i.length?(O.createTicketsList(i,"#allContainer"),featureList3=filterList("allContainer","",e)):(console.log("could not load local data"),a=10),setTimeout(function(){t("tickets?status=allopen&limit=100&query=all").then(function(t){O.createTicketsList(t,"#allContainer",o),featureList3=filterList("allContainer","",e),reveal()},function(e){showError(e),console.log("fail @ all ticket List")})},a)},altTickets:function(e){var o="alt",i=localStorage.getItem(o+"tickets"),a=cacheTime;i&&(i=JSON.parse(i)),i&&0!=i.length?(O.createTicketsList(i,"#altContainer"),featureList4=filterList("altContainer","",e)):(console.log("could not load local data"),a=10),setTimeout(function(){t("tickets?status=open&limit=100&role=alt_tech").then(function(t){O.createTicketsList(t,"#altContainer",o),featureList4=filterList("altContainer","",e)},function(e){showError(e),console.log("fail @ all ticket List")})},a)},userTickets:function(e){$("maxSize").hide();var o="user",i=localStorage.getItem(o+"tickets"),a=cacheTime;i&&(i=JSON.parse(i)),i&&0!=i.length?(O.createTicketsList(i,"#userContainer"),featureList5=filterList("userContainer","",e)):(console.log("could not load local data"),a=10),setTimeout(function(){t("tickets?status=open,onhold&limit=100&role=user").then(function(t){O.createTicketsList(t,"#userContainer",o),featureList5=filterList("userContainer","",e)},function(e){showError(e),console.log("fail @ user Container")})},a)}},j={init:function(e,t){$(document).on("click",".tableRows, .listedAccount",function(){localStorage.setItem("DetailedAccount",$(this).attr("data-id")),window.location="account_details.html"}),cacheName="storageAccountList",j.listAccounts(e,t)},listAccounts:function(e,o){var i=cacheTime,a=localStorage.getItem("storageAccountList");a&&(a=JSON.parse(a)),a&&0!=a.length?(o?(cacheName="dash",j.createDashAccountsList(e,a)):j.createAccountsList(e,a),reveal()):(console.log("could not load local data"),i=10),setTimeout(function(){t("accounts?limit=300").then(function(t){o?j.createDashAccountsList(e,t):j.createAccountsList(e,t),localStorage.setItem("storageAccountList",JSON.stringify(t)),reveal()},function(e){showError(e),console.log("fail @ Account List")})},i)},createAccountsList:function(e,t){if(t.length<1){var o='<h1 class="noTicketMessage">No Accounts</h1>';$(o).html(e)}else{for(var i=[],a=t.length,s=$(e),n=0;a>n;n+=1){t[n].index=t[n].id+","+n;var c=t[n].account_statistics.ticket_counts.open,l=t[n].name;i.push("<ul class='listedAccount item' data-id="+t[n].id+"><li class=user_name>"+l+"</li><li><div class='tks' "+(c>99?"style='height: 42px;'>99<sup>+</sup>":">"+c)+"</div></li></ul>"),a>10&&10==n&&s.html(i.join(""))}s.html(i.join("")),createSpan(e),filterList("ActiveAccountsContainer")}},createDashAccountsList:function(e,t){for(var o=["<ul class='tableHeader'><li></li><li>Hours</li><li>Expenses</li><li>Tkts</li></ul>"],i=t.length,a=$(e),s=0;i>s;s+=1){t[s].index=t[s].id+","+s;var n=t[s].account_statistics.ticket_counts.open;if(!(1>n)){var c=t[s].name,l=Math.min(t[s].account_statistics.hours||0,999);o.push("<ul class='tableRows clickme' data-id="+t[s].id+"><li>"+c+"</li><li>"+l+"</li><li>"+localStorage.getItem("currency")+Number(t[s].account_statistics.expenses).toFixed(2)+"</li><li><div class='tks1 "+(n>99?"overflowTickets' style='height: 42px;'>99<sup>+</sup>":"'>"+n)+"</div></li></ul>"),i>10&&10==s&&a.html(o.join(""))}}a.html(o.join(""))}};$(document).on("click",".timelog",function(){localStorage.setItem("timeNumber",$(this).attr("data-info")),window.location="edit_time.html"});var x={init:function(){this.getLogs()},getLogs:function(){t("time",{limit:200}).then(function(e){if($("#timelogs").empty(),e.length<1){var t='<h1 class="noTicketMessage">No Timelogs</h1>';$(t).appendTo("#timelogs")}else for(var o=0;o<e.length;o++){var i=$.md5(e[o].user_email),a=e[o].note,s=e[o].time_id,n=e[o].hours.toString(),c=e[o].user_name;-1==n.indexOf(".")&&(n+=".00");var l="<li class=item><ul class='timelog' data-id="+s+" data-info='"+JSON.stringify(e[o]).replace(/'/g,"")+"'> <li><img class='timelogProfile' src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80'></li><li><h2 class='feedName dots user_name'>"+c+"</h2><p class='taskDescription responseText'>"+a+"</p></li><li><img class='feedClock'src='img/clock_icon_small.png'><h3 class='feedTime'><span>"+n+"</span></h3></li></ul></li>";$(l).appendTo("#timelogs"),9==o&&reveal()}createSpan("#timelogs"),reveal(),e.length>1&&filterList("timelogs")},function(e){showError(e),console.log("fail @ time logs")})}},C={init:function(){var e=localStorage.getItem("DetailedAccount");localStorage.setItem("addAccountTicket",e),isInvoice?$("#invoiceOption").click(function(){window.location="Invoice_List.html"}):$("#invoiceOption").parent().remove(),this.pageSetup(),this.slideDown()},slideDown:function(){$("#openTicketslink").click(function(){$("html,body").animate({scrollTop:$("#openTickets").offset().top},"400")})},createAccDetails:function(e){e.account_statistics.ticket_counts.closed>0&&$(".buttonShowClosedTickets").show();var t=Math.min(e.account_statistics.hours,999),o=Math.min(e.account_statistics.ticket_counts.open,999),i=Math.min(e.account_statistics.invoices,999),a=Math.min(e.account_statistics.expenses,999);$("#AD").html(e.name),$("#ticketsOptionTicker").html(o),$("#invoiceOptionTicker").html(i),$("#timesOptionTicker").html(t),$("#expenseOptionTicker").html(localStorage.currency+Number(a).toFixed(2).toString())},pageSetup:function(){var e,o,i=localStorage.getItem("DetailedAccount"),a=localStorage.getItem("account"+i+"tickets"),s=cacheTime,n=cacheTime,c=localStorage.getItem("storageAccountList");c&&(o=new RegExp('"'+i+",(\\d+)").exec(c),o&&(c=JSON.parse(c),e=c[Number(o[1])])),a?(a=JSON.parse(a),O.createTicketsList(a,".AccountDetailsTicketsContainer"),filterList("AccountDetailsTicketsContainer")):(n=10,console.log("could not load local account tickets data")),e&&0!=e.length?C.createAccDetails(e):(console.log("could not load local account details data"),s=10),setTimeout(function(){t("accounts/"+i).then(function(t){C.createAccDetails(t),e&&(c[Number(o[1])].account_statistics=t.account_statistics,localStorage.setItem("storageAccountList",JSON.stringify(c)))},function(e){showError(e),console.log("fail @ storage Account List")})},s),setTimeout(function(){t("tickets?status=open&account="+i).then(function(e){O.createTicketsList(e,".AccountDetailsTicketsContainer","account"+i),filterList("AccountDetailsTicketsContainer")},function(e){showError(e),console.log("fail @ Account")})},n)}},E={init:function(){$("#addTimeAccount").click(function(){window.location="add_time.html"}),this.getTimeLogs()},getTimeLogs:function(){var e=localStorage.getItem("DetailedAccount")||-1;t("time?account="+e).then(function(e){if($("#accountLogs").empty(),e.length<1){var t='<h1 class="noTicketMessage">No Timelogs</h1>';$(t).appendTo("#accountLogs")}else for(var o=0;o<e.length;o++){var i=$.md5(e[o].user_email),a=e[o].note,s=e[o].hours.toString();-1==s.indexOf(".")&&(s+=".00");var n=e[o].user_name,c="<li><ul class='timelog' data-info='"+JSON.stringify(e[o]).replace(/'/g,"")+"'> <li><img class='timelogProfile' src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80'></li><li><h2 class='feedName dots'>"+n+"</h2><p class='taskDescription'>"+a+"</p></li><li><img class='feedClock'src='img/clock_icon_small.png'><h3 class='feedTime'><span>"+s+"</span></h3></li></ul></li>";$(c).appendTo("#accountLogs")}},function(e){showError(e),console.log("fail @ accountlogs")})}},D={init:function(){$("html,body").css("scrollTop","0");var e=10,o=localStorage.ticketsStat;o&&(o=JSON.parse(o)),o?D.setTicketCounts(o):console.log("no cache TicketsCounts"),setTimeout(function(){t("tickets/counts").then(function(e){D.setTicketCounts(e),reveal(),localStorage.setItem("ticketsStat",JSON.stringify(e))},function(e){showError(e),console.log("fail @ get TicketsCounts")})},e),$(document).on("click","#asUserStat",function(){localStorage.setItem("ticketPage","asUser"),window.location="ticket_list.html"}),$(document).on("click","#techStat",function(){localStorage.setItem("ticketPage","asTech"),window.location="ticket_list.html"}),$(document).on("click","#asAltTechStat",function(){localStorage.setItem("ticketPage","asAltTech"),window.location="ticket_list.html"}),$(document).on("click","#allTicketsStat",function(){localStorage.setItem("ticketPage","allTickets"),window.location="ticket_list.html"})},setTicketCounts:function(e){var t=e.open_all;t>100?t="&nbsp;99<sup>+</sup>":$("#all").removeClass("headerOverflowTickets"),$("#all").html(t),$("#userStat").html(e.open_as_user),$("#techStat").html(e.open_as_tech),$("#altStat").html(e.open_as_alttech)}},U=function(e,o,i,a){"undefined"==typeof i&&(i=!0),e&&o||(e=localStorage.getItem("userOrgKey"),o=localStorage.getItem("userInstanceKey")),e&&o&&t("config").then(function(e){localStorage.setItem("userRole",e.user.is_techoradmin?"tech":"user"),isTech=e.user.is_techoradmin,localStorage.setItem("projectTracking",e.is_project_tracking),localStorage.setItem("timeTracking",e.is_time_tracking),localStorage.setItem("accountManager",e.is_account_manager),localStorage.setItem("ticketLevels",e.is_ticket_levels),localStorage.setItem("classTracking",e.is_class_tracking),localStorage.setItem("locationTracking",e.is_location_tracking),localStorage.setItem("freshbooks",e.is_freshbooks),localStorage.setItem("is_invoice",e.is_invoice),localStorage.setItem("is_expenses",e.is_expenses),localStorage.setItem("is_travel_costs",e.is_travel_costs),localStorage.setItem("currency",e.currency),localStorage.setItem("userFullName",e.user.firstname+" "+e.user.lastname),localStorage.setItem("userId",e.user.user_id),a&&"function"==typeof a?a():getInfo4Extension(),i&&(window.location=isTech?"dashboard.html":"ticket_list.html")},function(e,t,o){showError(o),console.log("fail @ config")})},F={init:function(){return $(".instSelect").hide(),localStorage.setItem("userRole","user"),c&&r?void U(c,r):void this.getOrg()},getOrg:function(){$("body").show1(),$("#loading").show1(),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa("x:"+u))},url:ApiSite+"organizations/",async:!0,cache:!1,dataType:"json",success:function(e){if(e.length>1){localStorage.setItem("sd_is_MultipleOrgInst","true");for(var t=e,o=0;o<t.length;o++){var i="<li class=item><div id='org' data-id="+o+" class='OptionWrapper1'><h3 class='OptionTitle dots user_name'>"+t[o].name+"</h3></div></li>";$("#orgsPage").append(i)}$(document).on("click","#org",function(){var t=$(this).attr("data-id");c=e[t].key,l=e[t].name;var o=e[t].instances;if(localStorage.setItem("userOrgKey",c),localStorage.setItem("userOrg",l),0==o.length)return void userMessage.showMessage(!1,"You are not associated with any Instance in the Organization or your account is inactivated in the Instances.");if(1==o.length)r=o[0].key,localStorage.setItem("userInstanceKey",r),U(c,r);else{$("#instsPage").empty(),$("div.OptionWrapper1[data-id!='"+t+"']").parent().remove();for(var i=0;i<o.length;i++){var a="<li class=item><div id='inst' data-id="+i+" class='OptionWrapper2'><h3 class='OptionTitle dots user_name'>"+o[i].name+"</h3></div></li>";$("#instsPage").append(a)}$(".instSelect").show(),$(document).on("click","#inst",function(){var e=o[$(this).attr("data-id")].key;localStorage.setItem("userInstanceKey",e),localStorage.setItem("sd_is_MultipleOrgInst","true"),$("#loading").show1(),U(c,e)})}})}if(1==e.length){c=e[0].key,l=e[0].name,localStorage.setItem("userOrgKey",c),localStorage.setItem("sd_is_MultipleOrgInst","false"),localStorage.setItem("userOrg",l);var i="<li class=item><div id='org' data-id=0 class='OptionWrapper1'><h3 class='OptionTitle dots user_name'>"+e[0].name+"</h3></div></li>";$("#orgsPage").append(i);var a=e[0].instances;if(1==a.length)r=a[0].key,localStorage.setItem("userInstanceKey",r),U(c,r);else{$("#instsPage").empty();for(var o=0;o<a.length;o++){var i="<li class=item><div id='inst' data-id="+o+" class='OptionWrapper2'><h3 class='OptionTitle dots user_name'>"+a[o].name+"</h3></div></li>";$("#instsPage").append(i)}$(".instSelect").show(),$(document).on("click","#inst",function(){var e=a[$(this).attr("data-id")].key;localStorage.setItem("userInstanceKey",e),localStorage.setItem("sd_is_MultipleOrgInst","true"),$("#loading").show1(),U(c,e)})}}},complete:function(){c=localStorage.getItem("userOrgKey"),r=localStorage.getItem("userInstanceKey"),c&&r||reveal()},error:function(){console.log("fail @ getOrg"),logout()}})}};!function(){if(function(e,t,o,i,a,s,n){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,s=t.createElement(o),n=t.getElementsByTagName(o)[0],s.async=1,s.src=i,n.parentNode.insertBefore(s,n)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-998328-15","auto"),ga("send","pageview"),"signup.html"==Page)return void g.init();userMessage.init(),localStorage.appVersion!==appVersion&&(localStorage.setItem("appVersion",appVersion),console.log("Version updated to "+appVersion),adMessage.length>1?setTimeout(function(){userMessage.showMessage(!0,adMessage,updatedFunction)},3e3):location.reload(!0));var e="login.html"==Page;
if(u=localStorage.getItem("userKey"),c=localStorage.getItem("userOrgKey"),r=localStorage.getItem("userInstanceKey"),!c||!r)return void(u?"org.html"!=Page?window.location="org.html":F.init():e?d.init():logout());if(e)return void(window.location="tech"===localStorage.getItem("userRole")?"dashboard.html":"ticket_list.html");if("org.html"==Page)return void F.init();var t=localStorage.loadTicketNumber;if(t&&"undefined"!=t)return localStorage.loadTicketNumber="",localStorage.setItem("ticketNumber",t),void(window.location="ticket_detail.html");if(updateStatusBar){var o=document.getElementsByTagName("header")[0];o&&(o.style.paddingTop="10px",o.style.height="63px",$("body").css("margin-top",function(e,t){return parseInt(t,10)+10+"px"})),o=document.getElementById("ptr"),o&&(o.style.marginTop="10px")}if(localStorage.lastclick){if(((new Date).valueOf()-Date.parse(localStorage.lastclick).valueOf())/60>1200)return localStorage.lastclick=new Date,void U("","",!1,a)}else localStorage.lastclick=new Date;a()}()});