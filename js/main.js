function checkURL(e){return null!=e.match(/\.(jpeg|jpg|gif|png)$/)}function onDeviceReady(){isPhonegap=!0,cordova.plugins.notification.badge&&(localStorage.badge>0?cordova.plugins.notification.badge.set(localStorage.badge):cordova.plugins.notification.badge.clear())}function openURL(e){window.open(e,"_blank","location=no,EnableViewPortScale=yes")}function openURLsystem(e){window.open(e,"_system")}function reveal(){$("#loading").fadeOut()}function errorLine(e){var t="location.reload(false)";$("#scroller").hide(),$(".catch-error").length||$("body").prepend('<div class="catch-error"><div class="catch-error-description"><h2>&nbsp;</h2><h2>&nbsp;</h2><h2>Something went wrong...</h2><div id="ctl00_PageBody_StackTrace" class="return-button"><p /><p /><h4>'+e+'</h4><h4>&nbsp;<p>P.S.  Uh... a Yeti just attacked your  camp!</h4><center><button class=loginButton style="width: 200px;" onclick="'+t+'">Refresh</button></center></div></div>')}function offLine(){var e="redirectToPage()";isOnline=!1,$(".catch-error").length||$("body").prepend('<div class="catch-error"><div class="catch-error-description"><h2>&nbsp;</h2><h2>&nbsp;</h2><h2>Check your internet connection!</h2><div id="ctl00_PageBody_StackTrace" class="return-button"><p /><p /><h4>P.S.  Uh... a Yeti just attacked your  camp!</h4><center><button class=loginButton style="width: 200px;" onclick="'+e+'">Refresh</button></center></div></div>')}function onLine(){isOnline||($(".catch-error").remove(),location.reload(!1)),isOnline=!0}function redirectToPage(){if(navigator.onLine)if(isPhonegap)onLine();else{var e=document.body.appendChild(document.createElement("img"));e.style.display="none",e.onload=function(){onLine()},e.onerror=function(){offLine()},e.src=MobileSite+"img/select_arrow.png?rand="+Math.random()}else offLine()}function logout(e,t){"undefined"==typeof e&&(e=!0),clearStorage(),localStorage.is_google?(localStorage.removeItem("userName"),localStorage.removeItem("is_google"),GooglelogOut()):e&&(window.location="index.html"+("undefined"==typeof t?"":"?f="+t))}function GooglelogOut(e){if(window.self!==window.top||confirm("Do you want to stay logged in Google account?"))window.location="index.html"+("undefined"==typeof isRedirect?"":"?f="+e);else{document.location.href=location.href.replace(/(.+\w\/)(.+)/,"$1")+"index.html"+("undefined"==typeof e?"":"?f="+e)}}function clearStorage(){var e=localStorage.userName,t=localStorage.appVersion;localStorage.clear(),localStorage.removeItem("userOrgKey"),localStorage.removeItem("userOrg"),localStorage.removeItem("userInstanceKey"),localStorage.removeItem("userKey"),localStorage.setItem("userName",e),localStorage.appVersion=t,window.self!==window.top&&window.top.postMessage("logout","*")}function getInfo4Extension(){if(window.self!==window.top){var e="login?t="+localStorage.getItem("userKey")+"&o="+localStorage.getItem("userOrgKey")+"&i="+localStorage.getItem("userInstanceKey");window.top.postMessage(e,"*")}}function fullapplink(){var e=AppSite+"?dept="+localStorage.getItem("userInstanceKey")+"&org="+localStorage.getItem("userOrgKey");return isPhonegap?$(".fullapplink").on("click",function(t){t.preventDefault(),openURLsystem(e)}):window.self!==window.top?$(".fullapplink").on("click",function(t){t.preventDefault();var a=window.__proto__.open;a.apply(window,[e,"_blank"])}):($(".fullapplink").attr("target","_blank"),$(".fullapplink").attr("href",e)),e}function htmlEscape(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function filterList(e,t,a){$("body").attr("id","search_wrap"),"undefined"!=typeof t&&t?t&&(t=t.split(",")):t=["blockNumber","responseText","TicketBlockNumber","user_name"];var i={listClass:e,item:"item",valueNames:t};return featureList=new List("search_wrap",i),"undefined"!=typeof a&&a&&(featureList.search(a),$(".search").val(a)),featureList.on("updated",function(){if(featureList.matchingItems.length>1){var e="There are "+featureList.matchingItems.length+" matching tickets.";console.log(e)}else 1==featureList.matchingItems.length||0==featureList.matchingItems.length&&console.log("Bummer...  0 items found")}),featureList}function float2int(e){return 0|e}function createElipse(e,t,a){var i=e.length;if(10>=i)return e;var o=$(window).width();o>650&&(o=650);var s;return t*=o,s=t/a,s=float2int(s),i-2>s&&(e=e.substring(0,s)+"..."),e}function createSpan(e){var t=$(window).height(),a=$("#content").height();t>a+60&&(a=t-a-60,$("<p id=fill style='height:"+a+"px'>&nbsp;</p>").appendTo(e+""))}var appVersion="18",adMessage="Cache improvements",Site="sherpadesk.com/",MobileSite="http://m."+Site,AppSite="https://app."+Site,ApiSite="http://api."+Site,isTech=!1,isProject=!0,isTime=!0,isAccount=!0,isLevel=!0,isClass=!0,isLocation=!0,isFreshbook=!0,isExpenses=!0,isTravelCosts=!0,isInvoice=!0,is_MultipleOrgInst=!0,cacheName="",cacheTime=1e4,isPhonegap=!1,isOnline=!0;document.addEventListener("deviceready",onDeviceReady,!1),document.addEventListener("offline",offLine,!1),document.addEventListener("online",onLine,!1),$(document).ajaxError(function(e,t,a){(403==t.status&&a.url!==ApiSite+"organizations"||404==t.status&&a.url===ApiSite+"config")&&logout(a.url!==ApiSite+"login",t.statusText),setTimeout(function(){$("#loading").hide(),$(".page").show(),redirectToPage()},1e3)}),window.onerror=function(e,t,a,i,o){var s=i?"<p>column: "+i:"";s+=o?"<p>error: "+o:"",a>0&&setTimeout(function(){errorLine("<p onclick='$(\".err\").toggle();'>Click for Error Details:</p><div class=err style='display:none;'>"+e+"<p>page: "+location.href+"<p>url: "+t+"<p>line: "+a+s+"</div>"),$("#loading").hide(),$(".page").show()},1e3);var n=!0;return n},window.onload=function(){"object"==typeof WebPullToRefresh&&WebPullToRefresh.init({loadingFunction:function(){"dash"===cacheName?(localStorage.setItem("storageQueues",""),localStorage.setItem("storageAccountList",""),localStorage.setItem("ticketsStat","")):localStorage.setItem(cacheName,""),location.reload(!1)}})},"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var featureList,featureList2,featureList3,featureList4,featureList5;$(document).ready(function(){function e(e,t,a){var i=localStorage.getItem("userKey"),o=localStorage.getItem("userOrgKey"),s=localStorage.getItem("userInstanceKey");return i&&o&&s?(a||(a="GET"),$.ajax({type:a,beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(o+"-"+s+":"+i))},url:ApiSite+e,cache:!0,data:t,dataType:"json"}).promise()):void console.log("Invalid organization!")}function t(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function a(){var e=location.protocol+"//"+location.host+location.pathname;window.history.replaceState({},document.title,e)}function i(e,t,a,i,o,s,n){if("undefined"==typeof e||!e||!e.length)return $(""+t).parent().hide(),0;var c,l=!1;"undefined"!=typeof o&&o.length>0&&(c=o.split(","),c.length>0&&(l=!0)),"undefined"==typeof i&&(i=""),"undefined"==typeof a&&(a=""),"undefined"==typeof s&&(s=""),"undefined"==typeof n&&(n="");var r=""+a,u=0;for(u=0;u<e.length;u++){var m=e[u].id,d="";if(l)for(var g=0;g<c.length;g++)d+=" "+e[u][c[g]];else d=e[u].name;r+="<option value="+m+">"+i+d+"</option>"}return u>0?($(""+s+r+n).appendTo(""+t),$(""+t).parent().show(),$(""+t).parent().parent().show()):$(""+t).parent().hide(),u}function o(e,t,a){return isClass?(i(e,t,a,"Class: "),void $(""+t).on("change",function(){$(".sub_class1, .sub_class2").is(":visible")&&($(".sub_class1, .sub_class2").hide(),$("#sub_class1, #sub_class2").empty());var a=$(t+" option:selected").val(),o=$.grep(e,function(e){return e.id==a});c=a,"undefined"!=typeof o[0]&&(null!==o[0].sub||o[0].sub>0)&&(i(o[0].sub,"#sub_class1","<option value="+c+">choose a sub class</option>","Sub class: "),$("select#sub_class1").on("change",function(){$(".sub_class2").is(":visible")&&($(".sub_class2").hide(),$("#sub_class2").empty());var e=$("select#sub_class1 option:selected").val(),t=$.grep(o[0].sub,function(t){return t.id==e});c=e,"undefined"!=typeof t[0]&&(t[0].sub>0||null!==t[0].sub)&&(i(t[0].sub,"#sub_class2","<option value="+c+">Sub Sub Class: ---</option>","Sub Sub Class: "),$("select#sub_class2").on("change",function(){var e=$("select#sub_class2 option:selected").val();c=e}))}))})):void $(""+t).parent().parent().hide()}function s(){if("tech"===localStorage.getItem("userRole")&&(isTech=!0),"false"===localStorage.getItem("projectTracking")&&(isProject=!1),"false"===localStorage.getItem("timeTracking")&&(isTime=!1),"false"===localStorage.getItem("accountManager")&&(isAccount=!1),"false"===localStorage.getItem("ticketLevels")&&(isLevel=!1),"false"===localStorage.getItem("classTracking")&&(isClass=!1),"false"===localStorage.getItem("locationTracking")&&(isLocation=!1),"false"===localStorage.getItem("freshbooks")&&(isFreshbook=!1),"false"===localStorage.getItem("is_invoice")&&(isInvoice=!1),"false"===localStorage.getItem("is_expenses")&&(isExpenses=!1),"false"===localStorage.getItem("is_travel_costs")&&(isTravelCosts=!1),"false"===localStorage.getItem("sd_is_MultipleOrgInst")?(is_MultipleOrgInst=!1,$("#switchOrg").hide()):$("#switchOrg").show(),isTime||$(".time").remove(),localStorage.appVersion!==appVersion&&(localStorage.setItem("appVersion",appVersion),console.log("Version updated to "+appVersion),adMessage.length>1?setTimeout(function(){z.showMessage(!0,adMessage,function(){localStorage.setItem("storageQueues",""),localStorage.setItem("storageAccountList",""),location.reload(!0)})},3e3):location.reload(!0)),fullapplink(),"undefined"!=typeof navigator.splashscreen&&navigator.splashscreen.hide(),isTech){if(isAccount||$("#itemAccount").parent().hide(),isInvoice||($("#itemInvoice").hide(),$("#invoiceFooter").hide(),$("#invoiceFooter").next().hide()),location.pathname.endsWith("dashboard.html")){localStorage.DetailedAccount="";var e=localStorage.getItem("userOrg");return e&&$("#indexTitle").html(e),R.init(),P.init("#DashBoradQueues",3),isAccount&&B.init("#activeList",1),void b.init()}if(location.pathname.endsWith("account_details.html"))return void(isAccount?(isInvoice||$("#invoiceOption").parent().remove(),E.init(),p.pageChange()):window.location="dashboard.html");if(location.pathname.endsWith("Account_List.html"))return void(isAccount?(localStorage.DetailedAccount="",B.init("#fullList")):window.location="dashboard.html");if(location.pathname.endsWith("timelog.html"))return void(isTime?K.init():window.location="dashboard.html");if(location.pathname.endsWith("accountTimes.html"))return void(isTime&&isAccount?D.init():window.location="dashboard.html");if(location.pathname.endsWith("allInvoice_List.html"))return void(isTime&&isInvoice?L.init():window.location="dashboard.html");if(location.pathname.endsWith("Invoice_List.html"))return void(isTime&&isInvoice?L.init(localStorage.getItem("DetailedAccount")):window.location="dashboard.html");if(location.pathname.endsWith("invoice.html"))return void(isTime&&isInvoice?(N.init(),_.init(),v.init()):window.location="dashboard.html");if(location.pathname.endsWith("Queues.html"))return void P.init("#queuesPage");if(location.pathname.endsWith("queueTickets.html"))return void j.init()}else $(".sideNavLinks").children(":not('.user')").hide();return location.pathname.endsWith("ticket_list.html")?void M.init():location.pathname.endsWith("ticket_detail.html")?(O.init(),h.init(),f.init(),k.init(),void I.init()):location.pathname.endsWith("closedTickets.html")?void p.init():($("#loading").show(),location.pathname.endsWith("addTicketTime.html")?void(isTime?x.init():window.location="dashboard.html"):location.pathname.endsWith("add_tickets.html")?void w.init():location.pathname.endsWith("add_time.html")?void(isTime?x.init():window.location="dashboard.html"):location.pathname.endsWith("addExpence.html")?void(isExpenses?A.init():window.location="dashboard.html"):location.pathname.endsWith("edit_time.html")?void(isTime?x.init(!0):window.location="dashboard.html"):void 0)}var n=new Image;n.src=MobileSite+"img/error-background.png";var c,l="",r="",u="",m="",d={init:function(){var e=!0;if(location.pathname.indexOf("index.html")<0&&"/"!=location.pathname&&(e=!1),m=localStorage.getItem("userKey"),l=localStorage.getItem("userOrgKey"),u=localStorage.getItem("userInstanceKey"),(!m||!l||!u)&&!e&&location.pathname.indexOf("org.html")<0&&location.pathname.indexOf("signup.html")<0)return void logout();if(e){if(m&&l&&u)return void q(l,u);if(m)return void(window.location="org.html");var i=t("t"),o=t("e");if(i)return a(),localStorage.setItem("is_google",!0),localStorage.setItem("userKey",i),localStorage.setItem("userName",o),void(window.location="org.html");var s=t("f");s&&(a(),z.showMessage(!1,s)),this.login()}},do_login:function(){var e=$("#userName").val(),t=$("#password").val();return""==e||""==t?void z.showMessage(!1,"Please enter a valid Email or Password"):void $.ajax({type:"POST",beforeSend:function(a){a.withCredentials=!0,a.setRequestHeader("Authorization","Basic "+btoa(e+":"+t))},url:ApiSite+"login",dataType:"json",success:function(t){localStorage.setItem("userKey",t.api_token),localStorage.setItem("userName",e),window.location="org.html"},complete:function(){},error:function(){e&&-1!=e.indexOf("@gmail.com")?z.showMessage(!1,"Wrong Password, Google sign password is not neeeded"):(z.showMessage(!1,"There was a problem with your login.  Please try again."),$("#password").val(""))}})},login:function(){$(".page").show(),m=localStorage.getItem("userKey");var e=localStorage.getItem("userName");null!==e&&e.length>0&&$("#userName").val(e),$("#login_signup").on("click",function(e){e.preventDefault(),document.location.href="signup.html"}),$("form.google_openid").get(0).setAttribute("action",ApiSite+"api/auth/googleopenid"),$("#sign_in_with_google").on("click",function(e){e.preventDefault(),window.self!==window.top,$("form.google_openid").get(0).submit()}),$("#loginButton").click(function(){d.do_login()}),$(document).on("keypress","#password, #userName",function(e){13==e.which&&d.do_login()}),reveal()}},g={init:function(){if(!(location.pathname.indexOf("signup.html")<0)){var e=localStorage.getItem("userName");null!==e&&e.length>0&&$("#email").val(e),$("#signupButton").click(function(){g.add()}),$(document).on("change","#name",function(){var e=$("#name").val();e&&$("#url").val(e.replace(/[^a-zA-Z 0-9]+|[\s]+/g,"").toLowerCase())}),$("#is_force_registration").prop("checked",!1),reveal()}},add:function(){var e=$("#name").val(),t=$("#email").val(),a=$("#url").val(),i=$("#firstname").val(),o=$("#lastname").val(),s=$("#password").val(),n=$("#password_confirm").val(),c=$("#how").val();return""==e||""==t||""==a||""==i||""==o||""==s||""==n?void z.showMessage(!1,"Please enter all fields!"):s!=n?void z.showMessage(!1,"Passwords do not match!"):void $.ajax({type:"POST",url:ApiSite+"organizations",dataType:"json",data:{name:e,email:t,url:a,is_force_registration:$("#is_force_registration").is(":checked"),firstname:i,lastname:o,password:s,password_confirm:n,how_did_you_hear_about_us:c,note:isPhonegap?"registered by iPhone":"registered from mobile site"},success:function(e){return e.api_token?e.organization&&e.instance?(localStorage.setItem("userKey",e.api_token),localStorage.setItem("userName",t),localStorage.setItem("userOrgKey",e.organization),localStorage.setItem("userInstanceKey",e.instance),localStorage.setItem("userRole","user"),void q(e.organization,e.instance)):void(window.location="org.html"):void(window.location="index.html")},error:function(e){return 409==e.status?(z.showMessage(!1,"This email is already in use. Please choose action below"),localStorage.setItem("userName",$("#email").val()),$("#is_force_registration").prop("checked",!0),$("#signupButton").before("<center><h3 style='padding-top: 10px;'>This email is already in use. Would you like to</h3> <div class=loginButton onclick='window.location = \"index.html\"'>Login</div><h3>or</h3></center>"),void $("#signupButton").text("Create New Organization")):void z.showMessage(!1,e.statusText)}})}},p={init:function(){this.showClosedTickets(),this.pageChange()},pageChange:function(){$(".buttonShowClosedTickets").click(function(){window.location="closedTickets.html"})},showClosedTickets:function(){"truePos"==localStorage.getItem("isMessage")&&z.showMessage(!0),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets?status=closed&account="+localStorage.getItem("DetailedAccount"),dataType:"json",success:function(e){if($("#closedTickets").empty(),e.length>0)for(var t=0;t<e.length;t++){var a=$.md5(e[t].user_email),i=e[t].initial_post,o=e[t].subject,s=e[t].key;o=createElipse(o,.7,12);var n=e[t].is_new_tech_post&&e[t].technician_email!=localStorage.userName||e[t].is_new_user_post&&e[t].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";i.length>50&&(i=i.substring(0,50));var c="<ul class='responseBlock item' id='thisBlock' data-id="+s+"><li><p class='blockNumber numberStyle'>#"+e[t].number+"</p><img src='http://www.gravatar.com/avatar/"+a+"?d=mm&s=80' class='TicketBlockFace'><span  class=user_name>"+e[t].user_firstname+"</span></li><li class='responseText'><h4>"+n+o+"</h4><p class ='initailPost'>"+i+"</p></li><li><p class='TicketBlockNumber'>"+e[t].class_name+"</p></li></ul>";$(c).appendTo("#closedTickets"),filterList("closedTickets")}else $('<h1 class="noTicketMessage">No Tickets</h1>').appendTo("#closedTickets");reveal(),createSpan("#closedTickets")},error:function(){console.log("fail @ accounts")}})}},h={init:function(){this.pick()},pick:function(){$("#pickUp").click(function(){$.ajax({type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets/"+localStorage.getItem("ticketNumber"),data:{action:"pickup",note_text:""},dataType:"json",success:function(){z.showMessage(!0,'Ticket pickup was Succesfull <i class="fa fa-thumbs-o-up"></i>'),window.location="ticket_detail.html"},error:function(e,t){alert(t)}})})}},f={init:function(){this.transfer()},transfer:function(){$("#transfer").click(function(){$("#loading").removeAttr("style"),$("#loading").show(),$("#transfer").hide(),$("#transferSelect").show(),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"technicians?limit=200",dataType:"json",success:function(e){var t="<option value=0 disabled selected> Choose Tech</option>";$(t).appendTo("#transferTechs");for(var a=0;a<e.length;a++){var i=e[a].id,o=e[a].firstname+" "+e[a].lastname,t="<option value="+i+">"+o+"</option>";$(t).appendTo("#transferTechs")}},complete:function(){reveal()},error:function(){console.log("fail @ time accounts")}}),$("#transferTechs").on("change",function(){var e=$("#transferTechs").val();$.ajax({type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets/"+localStorage.getItem("ticketNumber"),data:{action:"transfer",note_text:" ",tech_id:e,keep_attached:!1},dataType:"json",success:function(){location.reload(!1)},error:function(e,t){alert(t)}})})})}},v={init:function(){this.addEm()},addEm:function(){$(document).on("keypress","#addEm",function(e){if(13==e.which){var t=$(".headerSearch").val().toLowerCase();localStorage.setItem("searchItem",t);{$("headerSearch").val()}}})}},k={init:function(){this.closeIt(),this.reopenIt()},reopenIt:function(){$("#openIt").click(function(){$.ajax({type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets/"+localStorage.getItem("ticketNumber"),data:{status:"open",note_text:""},success:function(){setTimeout(function(){z.showMessage(!0,'Ticket has been Reopened <i class="fa fa-thumbs-o-up"></i>'),window.history.back()},1e3)},error:function(e,t){alert(t)}})})},close:function(e){return e=htmlEscape(e).trim(),e.length<2?void z.showMessage(!1,"Note cannot be empty!"):e.length>5e3?void z.showMessage(!1,"Note cannot be more than 5000 chars!"):void $.ajax({type:"PUT",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets/"+localStorage.getItem("ticketNumber"),data:{status:"closed",note_text:e,is_send_notifications:!0,resolved:!0,dataType:"json",confirmed:!1,confirm_note:""},success:function(){setTimeout(function(){z.showMessage(!0,'Ticket has been closed <i class="fa fa-thumbs-o-up"></i>'),window.history.back()},1e3),z.setMessage(!0,"Ticket was Closed <i class='fa fa-thumbs-o-up'></i>")},error:function(){}})},closeIt:function(){$("#closeIt").click(function(){$("#closingMessage").slideDown(400,function(){$("#closeMessageButton").fadeIn(),$("html,body").animate({scrollTop:$("#closeMessageButton").offset().top},400)})}),$("#closeMessageButton").click(function(){k.close($("#closingMessage").val())}),$("#closeu").click(function(){k.close($("#commentText").val())})}},S=function(e){var t=e.substring(5,7),a=e.substring(8,10);switch(t){case"01":t="Jan";break;case"02":t="Feb";break;case"03":t="Mar";break;case"04":t="Apr";break;case"05":t="May";break;case"06":t="Jun";break;case"07":t="Jul";break;case"08":t="Aug";break;case"09":t="Sep";break;case"10":t="Oct";break;case"11":t="Nov";break;case"12":t="Dec";break;default:t="nul"}return t+" "+a},_={init:function(){this.submitInvoice()},submitInvoice:function(){$("#sendInvoiceButton").click(function(){if($(".recipient").children(".closeIcon").length<1)return void z.showMessage(!1,"No accounting contacts added");var e="";$.each($(".recipient").children(".closeIcon"),function(){e+=$(this).attr("id")+","}),console.log(e),$.ajax({type:"PUT",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"invoices/"+localStorage.getItem("invoiceNumber"),data:{action:"sendEmail",recipients:e},dataType:"json",success:function(){setTimeout(function(){window.history.back()},1e3),z.setMessage(!0,"Hurray! Invoice sent")},error:function(){}})})}},T={init:function(){this.logOut()},logOut:function(){$("#signOut").click(logout)}},y={init:function(){this.changeOrg()},changeOrg:function(){is_MultipleOrgInst&&$("#switchOrg").click(function(){var e=localStorage.appVersion,t=localStorage.userKey,a=localStorage.userName;localStorage.clear(),localStorage.userName=a,localStorage.userKey=t,localStorage.appVersion=e,window.location="org.html"})}},w={init:function(){this.addTicket()},addTicket:function(){$("#addTicketAccounts").empty();var t=localStorage.getItem("addAccountTicket");if(isTech)if(isAccount){var a=e("accounts?limit=300",{is_with_statistics:!1});a.then(function(e){$("#addTicketAccounts").empty(),i(e,"#addTicketAccounts","<option value=0 disabled selected>choose an account</option>"),t&&$("#addTicketAccounts").val(t),reveal()},function(){console.log("fail @ ticket accounts")})}else $("#addTicketAccounts").parent().hide(),reveal();else $("#addTicketAccounts").parent().hide();if(isTech){var s=e("technicians?limit=200");s.then(function(e){i(e,"#addTicketTechs","<option value=0 disabled selected>choose a tech</option>","","firstname,lastname")},function(){console.log("fail @ ticket accounts")})}else $("#addTicketTechs").parent().hide(),reveal();var n=e("classes");n.done(function(e){o(e,"#classTicketOptions","<option value=0 disabled selected>choose a class</option>")}),$("#submitNewTicket").click(function(){var t=htmlEscape($("#addTicketSubject").val().trim()),a=htmlEscape($("#addTicketInitPost").val().trim());if(""==t||""==$("#addTicketTechs").val()||1>c)z.showMessage(!1,"Please enter subject");else if(t.length>100)z.showMessage(!1,"Subject should be less 100 chars!");else if(a.length>5e3)z.showMessage(!1,"Details cannot be more than 5000 chars!");else{var i=e("tickets",{status:"open",subject:t,initial_post:a,class_id:c,account_id:$("#addTicketAccounts").val(),user_id:localStorage.getItem("userId"),tech_id:$("#addTicketTechs").val()},"POST");i.then(function(){localStorage.setItem("addAccountTicket",""),setTimeout(function(){window.location=isTech?"dashboard.html":"ticket_list.html"},1e3),z.setMessage(!0,"Ticket was Succesfully Created :)")},function(e,t){alert(t)})}})}},I={init:function(){this.sendComment()},sendComment:function(){$("#reply").click(function(){var e=htmlEscape($("#commentText").val().trim());return e?e.length>5e3?void z.showMessage(!1,"Note cannot be more than 5000 chars!"):void $.ajax({type:"POST",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets/"+localStorage.getItem("ticketNumber"),data:{note_text:e,action:"response"},dataType:"json",success:function(){location.reload(!1)},error:function(e,t){alert(t)}}):void z.showMessage(!1,"Please enter note")})}},b={init:function(){this.universalSearch()},universalSearch:function(){$(document).on("keypress","#searchThis",function(e){if(13==e.which){var t=$(".headerSearch").val().toLowerCase();return localStorage.setItem("searchItem",t),localStorage.setItem("ticketPage","asTech"),void(window.location="ticket_list.html")}})}},A={init:function(){this.addExpence(t("ticket"))},addExpence:function(t){var a=localStorage.DetailedAccount,i=0;if(!isProject||t)$("#timeProjects").parent().hide();else{var o="<option value=0>choose a project</option>";$(o).appendTo("#timeProjects")}!isAccount||t?($("#timeAccounts").parent().hide(),reveal()):e("accounts?limit=300",{is_with_statistics:!1}).then(function(e){$("#timeAccounts").empty();var t="<option value=0>choose an account</option>";$(t).appendTo("#timeAccounts");for(var o=0;o<e.length;o++){var s=e[o].id,n=e[o].name,c="<option value="+s+">"+n+"</option>";$(c).appendTo("#timeAccounts")}a&&($("#timeAccounts").val(a),x.chooseProjects(i,0)),reveal()},function(){console.log("fail @ time accounts")}),$("#timeAccounts").on("change",function(){x.chooseProjects(0,0)}),$("#addexpenseButton").click(function(){var a=$("#expenseAmount").val();if(!a)return void z.showMessage(!1,"Please enter amount");var i=htmlEscape($("#expenseNote").val()).trim();return i.length<1?void z.showMessage(!1,"Please enter note"):void e("expenses",{ticket_key:t?t:null,account_id:t?null:$("#timeAccounts").val(),project_id:t?null:$("#timeProjects").val(),tech_id:localStorage.getItem("user_id"),note:i,note_internal:$("#expenseInternal").val(),amount:a,is_billable:$(".innerCircle").hasClass("billFill"),vendor:$("#vendor").val()},"POST").then(function(){localStorage.setItem("isMessage","truePos"),localStorage.setItem("userMessage",'Expense was successfully added <i class="fa fa-money"></i>'),window.history.back()},function(e,t){console.log(t)})})}},x={init:function(e){this.addpicker(),this.inputTime(e)},addpicker:function(){jQuery("#date_start").datetimepicker({mask:!1,step:5,onShow:function(){var e,t=jQuery("#date_end").val();t&&(e=new Date(t),e.setDate(e.getDate())),this.setOptions({maxDate:t?e:!1})}}),jQuery("#date_end").datetimepicker({mask:!1,step:5,onShow:function(){var e,t=jQuery("#date_start").val();t&&(e=new Date(t),e.setDate(e.getDate())),this.setOptions({minDate:t?e:!1})}})},getTaskTypes:function(t,a){"undefined"==typeof a&&(a=0),$("#taskTypes").empty(),$("<option value=0>choose a task type</option>").appendTo("#taskTypes");var o=e("task_types",t);o.then(function(e){$("#taskTypes").empty(),i(e,"#taskTypes","<option value=0>choose a task type</option>"),a>0&&$("#taskTypes").val(a),reveal()},function(){console.log("fail @ task types")})},chooseProjects:function(t,a){"undefined"==typeof t&&(t=0),"undefined"==typeof a&&(a=0);var o=$("#timeAccounts").val();isProject?($("#timeProjects").on("change",function(){var e=$("#timeProjects").val();x.getTaskTypes({account:o,project:e},a)}),$("#timeProjects").empty(),$("<option value=0>choose a project</option>").appendTo("#timeProjects"),"0"!==o?($("#loading").fadeIn(),e("accounts/"+o,{is_with_statistics:!1}).then(function(e){i(e.projects,"#timeProjects"),$("#timeProjects").val(t),x.getTaskTypes({account:o,project:t},a),reveal()},function(){console.log("fail @ time accounts"),reveal()})):$("#timeProjects").parent().show()):x.getTaskTypes({account:o},a)},inputTime:function(t){{var a=localStorage.getItem("ticketNumber"),i=!0;(new Date).toJSON().slice(0,10)}if($("#submitTicketTime").click(function(){var t=$("#addTimeTicket").val(),o=htmlEscape($("#noteTimeTicket").val().trim()),s=localStorage.getItem("techId"),n=$("#ticketTaskTypes").val();if(o.length<1)return void z.showMessage(!1,"Please enter note");if(o.length>5e3)return void z.showMessage(!1,"Note cannot be more than 5000 chars!");i=$(".innerCircle").hasClass("billFill")?!0:!1;var c,l=jQuery("#date_start").val();l&&(c=JSON.stringify(new Date(l)));var r,u=jQuery("#date_end").val();u&&(r=JSON.stringify(new Date(u))),e("time",{ticket_key:a,note_text:o,task_type_id:n,hours:t,is_billable:i,date:l?c:"",start_date:l?c:"",stop_date:u?r:"",tech_id:s},"POST").then(function(){localStorage.setItem("isMessage","truePos"),localStorage.setItem("userMessage",'Time was successfully added <i class="fa fa-thumbs-o-up"></i>'),window.location.replace("ticket_detail.html")},function(e,t){alert(t)})}),$("#submitTicketTime").length)x.getTaskTypes({ticket:a},0);else{var o,s=localStorage.getItem("timeNumber");if(t&&s&&(o=JSON.parse(s),o.billable||$(".innerCircle").removeClass("billFill"),$("#noteTime").val(o.note),$("#addTimeTicket").val(o.hours),$(".title").html("Time #"+o.time_id+" by "+o.user_name+" @ "+new Date(o.date).dateFormat("Y/m/d H:i")),o.start_time&&$("#date_start").val(new Date(o.start_time).dateFormat("Y/m/d H:i")),o.stop_time&&$("#date_end").val(new Date(o.stop_time).dateFormat("Y/m/d H:i"))),isProject){var n="<option value=0>choose a project</option>";$(n).appendTo("#timeProjects")}else $("#timeProjects").parent().hide();$("#taskTypes").empty(),$("<option value=0>choose a task type</option>").appendTo("#taskTypes"),isAccount?e("accounts?limit=300",{is_with_statistics:!1}).then(function(e){$("#timeAccounts").empty();var t="<option value=0>choose an account</option>";$(t).appendTo("#timeAccounts");for(var a=0;a<e.length;a++){var i=e[a].id,s=e[a].name,n="<option value="+i+">"+s+"</option>";$(n).appendTo("#timeAccounts")}var c=localStorage.DetailedAccount?localStorage.DetailedAccount:-1,l=0,r=0;o&&(c=o.account_id,l=o.project_id,r=o.task_type_id),$("#timeAccounts").val(c),x.chooseProjects(l,r),reveal()},function(){console.log("fail @ time accounts")}):($("#timeAccounts").parent().hide(),reveal()),$("#timeAccounts").on("change",function(){x.chooseProjects(0,o?o.task_type_id:0)}),$("#submitTime").click(function(){var e=$("#addTimeTicket").val(),s=htmlEscape($("#noteTime").val().trim()),n=localStorage.getItem("userId"),c=$("#timeAccounts").val(),l=$("#timeProjects").val(),r=$("#taskTypes").val();i=$(".innerCircle").hasClass("billFill")?!0:!1;var u,m=jQuery("#date_start").val();m&&(u=JSON.stringify(new Date(m)));var d,g=jQuery("#date_end").val();return g&&(d=JSON.stringify(new Date(g))),0==e?void z.showMessage(!1,"Oops not enough time"):"0"==c?void z.showMessage(!1,"choose an account"):(a=parseInt(t?o.ticket_id:a),void $.ajax({type:t?"PUT":"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))
},url:ApiSite+"time"+(t?"/"+o.time_id:""),data:{tech_id:t?o.user_id:n,project_id:l,is_project_log:!a,ticket_id:a,account_id:c,note_text:s,task_type_id:r,hours:e,is_billable:i,date:m?u:"",start_date:m?u:"",stop_date:g?d:""},dataType:"json",success:function(){localStorage.setItem("isMessage","truePos"),localStorage.setItem("userMessage",'Time was successfully added <i class="fa fa-thumbs-o-up"></i>'),window.history.back()},error:function(e,t){alert(t)}}))})}}},O={init:function(){isTech?$("#closeu").hide():($(".tabs").hide(),$("#closeu").show()),isExpenses||$(".expense").hide(),this.showTicket()},showTicket:function(){"truePos"==localStorage.getItem("isMessage")&&z.showMessage(!0),$(document).on("click",".responseBlock",function(){localStorage.setItem("ticketNumber",$(this).attr("data-id")),window.location="ticket_detail.html"}),$("html,body").css("scrollTop","0"),e("tickets/"+localStorage.getItem("ticketNumber")).then(function(t){var a=t.daysold_in_minutes/-60;localStorage.setItem("techId",t.tech_id),localStorage.setItem("ticketId",t.id),$(".expense").attr("href","addExpence.html?ticket="+t.id),a>24?(a/=24,a=parseInt(a),a+=" days ago"):a=parseInt(a)+" hours ago","Closed"==t.status?($("#closeIt").hide(),$("#closeu").hide()):$("#openIt").hide();var s=t.total_hours;$("#ticketNumber").html(t.status+" | "+t.number),$("#ticketSubject").html(t.subject),$("#ticketClass").html(t.class_name),$("#ticketTech").html(t.tech_firstname),$("#lastUpdate").html(a),t.misc_cost?$("#expenses").html("Expenses: "+localStorage.currency+Number(t.misc_cost).toFixed(2).toString()):$("#expenses").hide(),0!=s?$("#ticketHours").html(s+" Hours"):$("#ticketHours").hide(),null==t.sla_complete_date?$("#ticketSLA").hide():$("#ticketSLA").html("SLA: "+t.sla_complete_date.toString().substring(0,10));var n=t.tech_email;n==localStorage.getItem("userName")&&$("#pickUp").hide();var l=e("classes"),r=e("priorities");if($("#ticketLevel").empty(),isLevel){var u=e("levels");u.done(function(e){i(e,"#ticketLevel","","Level: ")>0&&$("#ticketLevel").val(t.level)})}else $("#ticketLevel").parent().hide();$("#classOptions").empty(),l.done(function(e){c=t.class_id,o(e,"#classOptions","<option data-classId="+t.class_id+" value="+t.class_id+">Class: "+t.class_name+"</option>")}),$("#ticketPriority").empty(),r.done(function(e){for(var a="",i=0;i<e.length;i++)a+="<option value="+e[i].id+">Priority: "+e[i].priority_level+" - "+e[i].name+"</option>";$(a).appendTo("#ticketPriority"),$("#ticketPriority").val(t.priority_id)}),$("#ticketTechs").empty();for(var m=0;m<t.technicians.length;m++){var d=t.technicians[m].user_fullname,g=t.technicians[m].user_id,p="<option value="+g+">"+d+"</option>";$(p).appendTo("#ticketTechs")}if($("#location").remove(),isProject){var h=e("projects");h.done(function(e){i(e,"#ticketProject",""==t.project_name?"<option value='null' disabled selected>Project</option>":"")>0&&""!=t.project_name&&$("#ticketProject").val(t.project_id)})}else $("#project").hide();$(".updateButton").click(function(){var t=c,a=$("#ticketLevel").val(),i=$("#ticketPriority").val(),o=$("#ticketProject").val(),s={class_id:t,level_id:a,priority_id:i,project_id:o},n="tickets/"+localStorage.getItem("ticketId"),l=e(n,s,"PUT");l.then(function(){console.log("Then Complete"),z.setMessage(!0,"Ticket was successfully updated <i class='fa fa-thumbs-o-up'></i>"),window.location="ticket_detail.html",z.showMessage(!0)})}),$("#comments").empty();for(var f=1;f<t.ticketlogs.length;f++){var v=$.md5(t.ticketlogs[f].user_email),k=t.ticketlogs[f].log_type,_=t.ticketlogs[f].user_firstname+" "+t.ticketlogs[f].user_lastname,T=t.ticketlogs[f].note,y=t.ticketlogs[f].record_date.toString().substring(0,10);y=S(y);var w=[];if(null!=t.attachments)for(var I=0;I<t.attachments.length;I++)T.indexOf(t.attachments[I].name)>=0&&w.push(t.attachments[I].url);var p="<ul class='commentBlock'><li><img src='http://www.gravatar.com/avatar/"+v+"?d=mm&s=80' class='commentImg'></li><li class='commentText'><h3>"+_+"</h3></li><li><span>"+y+"</span></li><li class='commentText'><p>"+$("<span />",{html:T}).text().replace(/\n/g,"<p></p>").replace("/<br>/g","<p></p>")+"</p></li><li>"+k+"</li></ul>";$(p).appendTo("#comments");for(var b=0;b<w.length;b++){var A,p="";A=checkURL(w[b])?'<img class="attachment" src="'+w[b]+'">':"<img style='float:none;' src='img/file.png'>&nbsp;"+w[b].split("/").slice(-1)+"<p></p>",p=isPhonegap?'<a class="comment_image_link" href=# onclick=\'openURL("'+w[b]+"\")'>"+A+"</a>":'<a class="comment_image_link" target="_blank" href="'+w[b]+'">'+A+"</a>",$(p).appendTo("#comments")}w.length>0&&(borderInsert="<div class='attachmentBorder'></div>",$(borderInsert).appendTo("#comments"))}$(".orginalMessageContainer").empty();var x=$.md5(t.ticketlogs[0].user_email),O=t.ticketlogs[0].record_date.toString().substring(0,10);O=S(O);var T=t.ticketlogs[0].note,w=[];if(null!=t.attachments)for(var I=0;I<t.attachments.length;I++)if(T.indexOf(t.attachments[I].name)>=0){var A;A=checkURL(t.attachments[I].url)?'<img class="attachment" src="'+t.attachments[I].url+'">':"<img style='float:none;' src='img/file.png'>&nbsp;"+t.attachments[I].name+"<p></p>",w[I]=isPhonegap?'<a class="comment_image_link" href=# onclick=\'openURL("'+t.attachments[I].url+"\")'>"+A+"</a>":'<a class="comment_image_link" target="_blank" href="'+t.attachments[I].url+'">'+A+"</a>",$(w[I]).error(function(){w[I]="0"})}var N="<ul class='commentBlock'><li><img src='http://www.gravatar.com/avatar/"+x+"?d=mm&s=80' class='commentImg'></li><li class='commentText'><h3>"+t.ticketlogs[0].user_firstname+" "+t.ticketlogs[0].user_lastname+"</h3></li><li><span>"+O+"</span></li><li class='commentText'><p>"+$("<span />",{html:t.ticketlogs[0].note}).text().replace(/\n/g,"<p></p>").replace("<br>","<p></p>")+"</p></li><li>"+t.ticketlogs[0].log_type+"</li></ul></div>";if($(N).appendTo(".orginalMessageContainer"),null!=t.attachments)for(var b=0;b<w.length;b++){var L=w[b];$(L).appendTo(".orginalMessageContainer")}reveal()},function(){console.log("fail @ Ticket Detail"),localStorage.setItem("ticketId",""),window.location="ticket_list.html"})}},N={init:function(){this.specifics()},specifics:function(){$(document).on("click",".invoiceRows",function(){localStorage.setItem("invoiceNumber",$(this).attr("data-id")),window.location="invoice.html"}),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"invoices/"+localStorage.getItem("invoiceNumber"),dataType:"json",success:function(e){localStorage.setItem("invoiceAccountId",e.account_id),localStorage.setItem("invoiceProjectId",e.project_id),$("#invoiceNumber").html("Invoice  #"+e.id);var t=e.customer;t=createElipse(t,.7,12),$("#customerName").html(t);var a=e.date.substring(0,10);a=S(a),$("#invoiceDate").html(a),$("#invoiceHours").html(e.total_hours+"<span class='detail3Small'>hrs</span>");var i=0,o=".00",s=e.amount.toString().length;if(e.amount.toString().indexOf(".")>=0?(i=e.amount.toString().substring(0,s-3),o="."+e.amount.toString().substring(s-2,s),o.indexOf("..")>=0&&(o="."+e.total_cost.toString().substring(s-1,s)+"0")):i=e.amount,$("#invoiceAmount").html(localStorage.getItem("currency")+i+"<span class='detail3Small'>"+o+"</span>"),isTravelCosts?$("#invoiceTravel").html(localStorage.getItem("currency")+e.travel_cost+"<span class='detail3Small'>.00</span>"):$("#invoiceTravel").parent().parent().hide(),isExpenses){var n=0;if(null!=e.expenses)for(var c=0;c<e.expenses.length;c++)n+=e.expenses[c].total;$("#invoiceExpenses").html(localStorage.getItem("currency")+n+"<span class='detail3Small'>.00</span>")}else $("#invoiceExpenses").parent().parent().hide();if($("#invoiceAdjustments").html(localStorage.getItem("currency")+"0<span class='detail3Small'>.00</span>"),console.log(Number(e.total_cost).toFixed(2).toString()),i=Number(e.total_cost).toFixed(2).toString(),o=i.substring(i.length-3,i.length),i=i.substring(0,i.length-3),$(".invoiceTotal").html(localStorage.getItem("currency")+i+"<span class='detail3Small'>"+o+"</span>"),$("#recipientList").empty(),null!=e.recipients&&e.recipients.length>0)for(var l=0;l<e.recipients.length;l++){var r=$.md5(e.recipients[l].email),u="<li><ul class='recipientDetail'><li><img src='http://www.gravatar.com/avatar/"+r+"?d=mm&s=80'></li><li><div class='recipient'><p>"+e.recipients[l].email+"</p>"+(e.recipients[l].is_accounting_contact?"<img class='closeIcon' id=\""+e.recipients[l].email+"\"  src='img/close_icon.png'>":'<img class=plusIcon id="'+e.recipients[l].email+"\" src='img/plus_icon.png'>")+"</div></li></ul></li>";$(u).appendTo("#recipientList")}else{var u="<li><h3 class=noDataMessage>No accounting contacts found.<p>&nbsp;</p></h3></li>";$(u).appendTo("#recipientList"),$("#sendInvoiceButton").remove()}if(createSpan("#recipientList"),$("#invoiceLogs").empty(),null!=e.time_logs)for(var m=0;m<e.time_logs.length;m++){var d=e.time_logs[m].name,g=e.time_logs[m].total,a=S(e.time_logs[m].date.substring(0,10)),p=e.time_logs[m].id,u="<li><ul id='invoiceTimelog' data-id='"+p+"' data-info='"+JSON.stringify(e.time_logs[m]).replace(/'/g,"")+"'  class='timelog'><li><div class='billable timeLogAddButton' data-id='"+p+"'><div class='innerCircle billFill'></div></div></li><li><h2 class='feedName'>"+d+"</h2><p class='taskDescription'>"+a+"</p></li><li><img class='feedClock' src='img/clock_icon_small.png'><h3 class='feedTime'><span>"+g+"</span></h3></li></ul></li>";$(u).appendTo("#invoiceLogs")}if(null!=e.recipients){$("#expensesList").empty();for(var h=0;h<e.expenses.length;h++){var d=e.expenses[h].name,g=e.expenses[h].total,a=S(e.expenses[h].date.substring(0,10)),p=e.expenses[h].id,u="<li><ul id='invoiceExpense' class='timelog1'><li><div class='billable timeLogAddButton' data-id='"+p+"'><div class='innerCircle billFill'></div></div></li><li><h2 class='feedName'>"+d+"</h2><p class='taskDescription'>"+a+"</p></li><li><h3 class='feedTime expenceCost'><span>$"+g+"</span></h3></li></ul></li>";$(u).appendTo("#expensesList")}}},complete:function(){reveal()},error:function(){console.log("fail @ Invoice details")}})}},L={init:function(e){this.listInvoices(e)},listInvoices:function(t){var a=[];$("#invoiceOption").click(function(){window.location="Invoice_List.html"}),$("#allInvoice, #invoiceFooter").click(function(){window.location="allInvoice_List.html"}),e("invoices",{account:t}).then(function(e){if($("#invoiceList").empty(),0==e.length)return $('<h3 class="noDataMessage">no invoices at this time</h3>').prependTo("#invoiceList"),createSpan("#invoiceList"),void reveal();t&&(e=[e]);for(var i=0;i<e.length;i++){var o=e[i].customer,s=e[i].date.substring(0,10);s=S(s),o=createElipse(o,.33,12);var n="<ul data-id="+e[i].id+" class='invoiceRows item'><li class=user_name>"+o+"</li><li class=responseText>"+s+"</li><li>$"+Number(e[i].total_cost).toFixed(2)+"</li></ul>";$(n).appendTo("#invoiceList"),t||a.push(n)}t||localStorage.setItem("storageInvoices",JSON.stringify(a)),createSpan("#invoiceList"),reveal()},function(){console.log("fail @ Invoice List")})}},j={init:function(){$(".title").html("Tickets @ "+localStorage.getItem("currentQueueName")+" Queue"),this.queueTickets()},queueTickets:function(){e("queues/"+localStorage.getItem("currentQueue")).then(function(e){if($("#queueTickets").empty(),e.length<1){var t='<h1 class="noTicketMessage">No Tickets</h1>';$(t).appendTo("#queueTickets")}for(var a=0;a<e.length;a++){var i=$.md5(e[a].user_email),o=e[a].initial_post,s=e[a].subject,n=e[a].key;s=createElipse(s,.7,12);var c=e[a].is_new_tech_post&&e[a].technician_email!=localStorage.userName||e[a].is_new_user_post&&e[a].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";o.length>100&&(o=o.substring(0,100));var l="<ul class='responseBlock item' id='thisBlock' data-id="+n+"><li><p class='blockNumber numberStyle'>#"+e[a].number+"</p><img src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[a].user_firstname+"</span></li><li class='responseText'><h4>"+c+s+"</h4><p class ='initafilPost'>"+o+"</p></li><li><p class='TicketBlockNumber'>"+e[a].class_name+"</p></li></ul>";$(l).appendTo("#queueTickets"),filterList("queueTickets"),reveal()}createSpan("#queueTickets"),reveal()},function(){console.log("fail @ Queues List")})}},P={init:function(e,t){cacheName="storageQueues",$(document).on("click","#queue",function(){localStorage.setItem("currentQueue",$(this).attr("data-id")),localStorage.setItem("currentQueueName",$(this).find(".OptionTitle").text()),window.location="queueTickets.html"}),P.queues(t,e)},queues:function(t,a){var i=localStorage.getItem("storageQueues"),o=cacheTime;i&&(i=JSON.parse(i)),void 0==i||null==i||0==i.length?(console.log("could not load local data"),o=10):(P.createQueuesList(a,i,t),t||createSpan(a)),setTimeout(function(){e("queues",{sort_by:"tickets_count"}).then(function(e){P.createQueuesList(a,e,t),localStorage.setItem("storageQueues",JSON.stringify(e)),reveal(),t||(createSpan(a),filterList("OptionsList"))},function(){console.log("fail @ Queues List")})},o)},createQueuesList:function(e,t,a){for(var i=0,o=[],s=t.length,n=$(e),c=0;s>c&&(0==t[c].fullname.toLowerCase().indexOf("new ticket")&&(i=t[c].tickets_count),!(a&&c>=a));c+=1)o.push("<li class=item><div id='queue' data-id="+t[c].id+" class='OptionWrapper'><h3 class='OptionTitle user_name'>"+t[c].fullname+"</h3></div><div class='NotificationWrapper'><h2>"+t[c].tickets_count+"</h2></div></li>"),s>10&&10==c&&n.html(o.join(""));n.html(o.join("")),localStorage.badge=i}},C="",M={init:function(){this.userTickets(),isTech?(this.techTickets(),this.altTickets(),this.allTickets()):$(".TicketTabs").hide(),this.ticketClick()},ticketClick:function(){$(document).on("click",".responseBlock",function(){localStorage.setItem("ticketNumber",$(this).attr("data-id")),window.location="ticket_detail.html"})},techTickets:function(){var e=localStorage.getItem("ticketPage");"asAltTech"==e?C="altContainer":"asTech"==e?C="techContainer":"asUser"==e?C="userContainer":"allTickets"==e&&(C="allContainer"),$("#techContainer, #optionsConainer, #allContainer, #userContainer").empty(),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets?status=open&limit=100&role=tech",dataType:"json",success:function(e){if(e.length<1){var t='<h1 class="noTicketMessage">No Tickets</h1>';$(t).appendTo("#techContainer")}else for(var a=0;a<e.length;a++){var i=$.md5(e[a].user_email),o=e[a].initial_post,s=e[a].subject,n=e[a].key;s=createElipse(s,.7,12);var c=e[a].is_new_tech_post&&e[a].technician_email!=localStorage.userName||e[a].is_new_user_post&&e[a].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";o.length>100&&(o=o.substring(0,100));var l="<ul class='responseBlock item' id='thisBlock' data-id="+n+"><li><p class='blockNumber numberStyle'>#"+e[a].number+"</p><img src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[a].user_firstname+"</span></li><li class='responseText'><h4>"+c+s+"</h4><p class ='initailPost'>"+o+"</p></li><li><p class='TicketBlockNumber'>"+e[a].class_name+"</p></li></ul>";$(l).appendTo("#techContainer")}createSpan("#techContainer")},complete:function(){featureList2=filterList("techContainer","",localStorage.getItem("searchItem"))},error:function(){console.log("fail @ ticket List")}})},allTickets:function(){$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets?status=allopen&limit=100&query=all",dataType:"json",success:function(e){if(e.length<1){var t='<h1 class="noTicketMessage">No Tickets</h1>';$(t).appendTo("#allContainer")}else for(var a=0;a<e.length;a++){var i=$.md5(e[a].user_email),o=e[a].initial_post,s=e[a].subject,n=e[a].key;s=createElipse(s,.7,12);var c=e[a].is_new_tech_post&&e[a].technician_email!=localStorage.userName||e[a].is_new_user_post&&e[a].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";o.length>100&&(o=o.substring(0,100));var l="<ul class='responseBlock item' id='thisBlock' data-id="+n+"><li><p class='blockNumber numberStyle'>#"+e[a].number+"</p><img src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[a].user_firstname+"</span></li><li class='responseText'><h4>"+c+s+"</h4><p class ='initailPost'>"+o+"</p></li><li><p class='TicketBlockNumber'>"+e[a].class_name+"</p></li></ul>";$(l).appendTo("#allContainer")}createSpan("#allContainer")},complete:function(){$(".TicketTabs > ul > li, .tabs > ul > li").css("color","rgba(255, 255, 255, 0.55)"),featureList3=filterList("allContainer","",localStorage.getItem("searchItem"));var e=localStorage.getItem("ticketPage");"asAltTech"==e?($("#tabpage_reply, #tabpage_all, #tabpage_info").hide(),$("#tabpage_options").fadeIn(),$("#altTab").css("color","#ffffff"),localStorage.setItem("ticketPage","asTech")):"asTech"==e?($("#tabpage_reply, #tabpage_all, #tabpage_options").hide(),$("#tabpage_info").fadeIn(),$("#userTab").css("color","#ffffff")):"asUser"==e?($("#tabpage_info, #tabpage_all, #tabpage_options").hide(),$("#tabpage_reply").fadeIn(),localStorage.setItem("ticketPage","asTech"),$("#replyTab").css("color","#ffffff")):"allTickets"==e?($("#tabpage_info, #tabpage_reply, #tabpage_options").hide(),$("#tabpage_all").fadeIn(),localStorage.setItem("ticketPage","asTech"),$("#openTab").css("color","#ffffff")):$("#replyTab").css("color","#ffffff"),localStorage.setItem("searchItem",""),reveal()},error:function(){console.log("fail @ ticket List")}})},altTickets:function(){$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets?status=open&limit=100&role=alt_tech",dataType:"json",success:function(e){if(e.length<1){var t='<h1 class="noTicketMessage">No Tickets</h1>';$(t).appendTo("#altContainer")}else for(var a=0;a<e.length;a++){var i=$.md5(e[a].user_email),o=e[a].initial_post,s=e[a].subject,n=e[a].key;s=createElipse(s,.75,12);var c=e[a].is_new_tech_post&&e[a].technician_email!=localStorage.userName||e[a].is_new_user_post&&e[a].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";o.length>100&&(o=o.substring(0,100));var l="<ul class='responseBlock item' id='thisBlock' data-id="+n+"><li><p class='blockNumber numberStyle'>#"+e[a].number+"</p><img src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[a].user_firstname+"</span></li><li class='responseText'><h4>"+c+s+"</h4><p class ='initailPost'>"+o+"</p></li><li><p class='TicketBlockNumber'>"+e[a].class_name+"</p></li></ul>";$(l).appendTo("#altContainer")}createSpan("#altContainer")},complete:function(){featureList4=filterList("altContainer","",localStorage.getItem("searchItem"))},error:function(){console.log("fail @ ticket List")}})},userTickets:function(){$("maxSize").hide(),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets?status=open,onhold&limit=100&role=user",dataType:"json",success:function(e){if(e.length<1){var t='<h1 class="noTicketMessage">No Tickets</h1>';$(t).appendTo("#userContainer")}else for(var a=0;a<e.length;a++){var i=$.md5(e[a].user_email),o=e[a].initial_post,s=e[a].subject,n=e[a].key;s=createElipse(s,.75,12);var c=e[a].is_new_tech_post&&e[a].technician_email!=localStorage.userName||e[a].is_new_user_post&&e[a].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";o.length>100&&(o=o.substring(0,100));var l="<ul class='responseBlock item' id='thisBlock' data-id="+n+"><li><p class='blockNumber numberStyle'>#"+e[a].number+"</p><img src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[a].user_firstname+"</span></li><li class='responseText'><h4>"+c+s+"</h4><p class ='initailPost'>"+o+"</p></li><li><p class='TicketBlockNumber'>"+e[a].class_name+"</p></li></ul>";$(l).appendTo("#userContainer")}createSpan("#userContainer")},complete:function(){isTech||($("#tabpage_reply").fadeIn(),reveal()),featureList5=filterList("userContainer","",localStorage.getItem("searchItem"))},error:function(){console.log("fail @ ticket List")}})}};String.format=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})};var B={init:function(e,t){cacheName="storageAccountList",B.listAccounts(e,t)},listAccounts:function(t,a){var i=cacheTime,o=localStorage.getItem("storageAccountList");o&&(o=JSON.parse(o)),void 0==o||null==o||0==o.length?(console.log("could not load local data"),i=10):(a?(cacheName="dash",B.createDashAccountsList(t,o)):B.createAccountsList(t,o),reveal()),setTimeout(function(){e("accounts?limit=300").then(function(e){a?B.createDashAccountsList(t,e):B.createAccountsList(t,e),localStorage.setItem("storageAccountList",JSON.stringify(e)),reveal()},function(){console.log("fail @ listAccounts")})},i)},createAccountsList:function(e,t){if(t.length<1){var a='<h1 class="noTicketMessage">No Accounts</h1>';$(a).html(e)}else{for(var i=[],o=t.length,s=$(e),n=0;o>n;n+=1){t[n].index=t[n].id+","+n;var c=t[n].account_statistics.ticket_counts.open,l=t[n].name;l=createElipse(l,.75,12),i.push("<ul class='listedAccount item' data-id="+t[n].id+"><li class=user_name>"+l+"</li><li><div class='tks' "+(c>99?"style='height: 42px;'>99<sup>+</sup>":">"+c)+"</div></li></ul>"),o>10&&10==n&&s.html(i.join(""))}s.html(i.join("")),createSpan(e),filterList("ActiveAccountsContainer")}},createDashAccountsList:function(e,t){for(var a=["<ul class='tableHeader'><li></li><li>Hours</li><li>Expenses</li><li>Tkts</li></ul>"],i=t.length,o=$(e),s=0;i>s;s+=1){t[s].index=t[s].id+","+s;var n=t[s].account_statistics.ticket_counts.open;if(!(1>n)){var c=t[s].name;c=createElipse(c,.3,12);var l=t[s].account_statistics.hours;l>999&&(l=999),a.push("<ul class='tableRows clickme' data-id="+t[s].id+"><li>"+c+"</li><li>"+l+"</li><li>"+localStorage.getItem("currency")+Number(t[s].account_statistics.expenses).toFixed(2)+"</li><li><div class='tks1 "+(n>99?"overflowTickets' style='height: 42px;'>99<sup>+</sup>":"'>"+n)+"</div></li></ul>"),i>10&&10==s&&o.html(a.join(""))}}o.html(a.join(""))}};$(document).on("click",".timelog",function(){localStorage.setItem("timeNumber",$(this).attr("data-info")),window.location="edit_time.html"});var K={init:function(){this.getLogs()},getLogs:function(){e("time",{limit:200}).then(function(e){if($("#timelogs").empty(),e.length<1){var t='<h1 class="noTicketMessage">No Timelogs</h1>';$(t).appendTo("#timelogs")}else for(var a=0;a<e.length;a++){var i=$.md5(e[a].user_email),o=e[a].note,s=e[a].time_id,n=e[a].hours;n=n.toString();var c=e[a].user_name;o=createElipse(o,.5,8),n.indexOf(".")>=0||(n+=".00"),c=createElipse(c,.5,12);var l="<li class=item><ul class='timelog' data-id="+s+" data-info='"+JSON.stringify(e[a]).replace(/'/g,"")+"'> <li><img class='timelogProfile' src='http://www.gravatar.com/avatar/"+i+"?d=mm&s=80'></li><li><h2 class='feedName user_name'>"+c+"</h2><p class='taskDescription responseText'>"+o+"</p></li><li><img class='feedClock'src='img/clock_icon_small.png'><h3 class='feedTime'><span>"+n+"</span></h3></li></ul></li>";$(l).appendTo("#timelogs"),9==a&&reveal()}createSpan("#timelogs"),reveal(),e.length>1&&filterList("timelogs")},function(){console.log("fail @ timelogs")})}},E={init:function(){this.pageSetup()},pageSetup:function(){var e,t,a,i,o=localStorage.getItem("DetailedAccount"),s=localStorage.getItem(o),n=localStorage.getItem(o+"tickets"),c=[];if(n=JSON.parse(n),s&&(s=JSON.parse(s)),void 0==s||null==s||0==s.length)console.log("could not load local data");else{$("#AD").html(s.name),$("#ticketsOptionTicker").html(s.tickets),$("#invoiceOptionTicker").html(s.invoices),$("#timesOptionTicker").html(s.hours);for(var l=0;l<n.length;l++){var r=n[l];$(r).appendTo(".AccountDetailsTicketsContainer")}reveal()}$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"accounts/"+localStorage.getItem("DetailedAccount"),dataType:"json",success:function(s){e=s.account_statistics.hours,t=s.account_statistics.ticket_counts.open,a=s.account_statistics.invoices,i=s.name,e>999&&(e="999"),e=e.toString(),t>999&&(t="999"),a>999&&(a="999"),$("#AD").html(i),$("#ticketsOptionTicker").html(t),$("#invoiceOptionTicker").html(a),$("#timesOptionTicker").html(e);var n={name:i,tickets:t,hours:e,invoices:a};localStorage.setItem(o,JSON.stringify(n))},complete:function(){reveal(),window.setTimeout(reveal,500)},error:function(){console.log("fail @ accounts")}}),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa(localStorage.getItem("userOrgKey")+"-"+localStorage.getItem("userInstanceKey")+":"+localStorage.getItem("userKey")))},url:ApiSite+"tickets?status=open&account="+localStorage.getItem("DetailedAccount"),dataType:"json",success:function(e){$(".AccountDetailsTicketsContainer").empty();for(var t=0;t<e.length;t++){var a=$.md5(e[t].user_email),i=e[t].initial_post,s=e[t].subject,n=e[t].key;s=createElipse(s,.75,12);var l=e[t].is_new_tech_post&&e[t].technician_email!=localStorage.userName||e[t].is_new_user_post&&e[t].user_email!=localStorage.userName?"<i class='fa fa-envelope-o' style='color: #25B0E6;'></i> ":"";i.length>50&&(i=i.substring(0,50));var r="<ul class='responseBlock item' id='thisBlock' data-id="+n+"><li><p class='blockNumber numberStyle'>#"+e[t].number+"</p><img src='http://www.gravatar.com/avatar/"+a+"?d=mm&s=80' class='TicketBlockFace'><span class=user_name>"+e[t].user_firstname+"</span></li><li class='responseText'><h4>"+l+s+"</h4><p class ='initailPost'>"+i+"</p></li><li><p class='TicketBlockNumber'>"+e[t].class_name+"</p></li></ul>";$(r).appendTo(".AccountDetailsTicketsContainer"),c.push(r),filterList("AccountDetailsTicketsContainer")}localStorage.setItem(o+"tickets",JSON.stringify(c))},error:function(){console.log("fail @ accounts")}})}},D={init:function(){$("#addTimeAccount").click(function(){window.location="add_time.html"}),this.getTimeLogs()},getTimeLogs:function(){var t=localStorage.getItem("DetailedAccount");t||(t=-1),e("time?account="+t).then(function(e){$("#accountLogs").empty();for(var t=0;t<e.length;t++){var a=$.md5(e[t].user_email),i=e[t].note,o=e[t].hours;o=o.toString(),o.indexOf(".")<0&&(o+=".00"),i=createElipse(i,.5,8);var s=e[t].user_name;s=createElipse(s,.5,12);var n="<li><ul class='timelog' data-info='"+JSON.stringify(e[t]).replace(/'/g,"")+"'> <li><img class='timelogProfile' src='http://www.gravatar.com/avatar/"+a+"?d=mm&s=80'></li><li><h2 class='feedName'>"+s+"</h2><p class='taskDescription'>"+i+"</p></li><li><img class='feedClock'src='img/clock_icon_small.png'><h3 class='feedTime'><span>"+o+"</span></h3></li></ul></li>";$(n).appendTo("#accountLogs")}},function(){console.log("fail @ timelogs")})}},R={init:function(){$("html,body").css("scrollTop","0");var t=cacheTime,a=localStorage.ticketsStat;a&&(a=JSON.parse(a)),a?R.setTicketCounts(a):(t=10,console.log("no cache TicketsCounts")),setTimeout(function(){e("tickets/counts").then(function(e){R.setTicketCounts(e),reveal(),localStorage.setItem("ticketsStat",JSON.stringify(e))},function(){console.log("fail @ get TicketsCounts")})},t)},setTicketCounts:function(e){var t=e.open_all;t>100?t="99<sup>+</sup>":$("#all").removeClass("headerOverflowTickets"),$("#all").html(t),$("#userStat").html(e.open_as_user),$("#techStat").html(e.open_as_tech),$("#altStat").html(e.open_as_alttech)}},q=function(t,a,i,o){"undefined"==typeof i&&(i=!0),t&&a||(t=localStorage.getItem("userOrgKey"),a=localStorage.getItem("userInstanceKey")),t&&a&&e("config").then(function(e){localStorage.setItem("userRole",e.user.is_techoradmin?"tech":"user"),isTech=e.user.is_techoradmin,localStorage.setItem("projectTracking",e.is_project_tracking),localStorage.setItem("timeTracking",e.is_time_tracking),localStorage.setItem("accountManager",e.is_account_manager),localStorage.setItem("ticketLevels",e.is_ticket_levels),localStorage.setItem("classTracking",e.is_class_tracking),localStorage.setItem("locationTracking",e.is_location_tracking),localStorage.setItem("freshbooks",e.is_freshbooks),localStorage.setItem("is_invoice",e.is_invoice),localStorage.setItem("is_expenses",e.is_expenses),localStorage.setItem("is_travel_costs",e.is_travel_costs),localStorage.setItem("currency",e.currency),localStorage.setItem("userFullName",e.user.firstname+" "+e.user.lastname),localStorage.setItem("userId",e.user.user_id),o&&"function"==typeof o?o():getInfo4Extension(),i&&(window.location=isTech?"dashboard.html":"ticket_list.html")},function(){console.log("fail @ config")})},F={init:function(){return location.pathname.indexOf("org.html")<0?void 0:($(".instSelect").hide(),(m=localStorage.getItem("userKey"))?(l=localStorage.getItem("userOrgKey"),u=localStorage.getItem("userInstanceKey"),localStorage.setItem("userRole","user"),l&&u?void q(l,u):void this.getOrg()):void(window.location="index.html"))},getOrg:function(){$(".page").show(),$("#loading").show(),m=localStorage.getItem("userKey"),$.ajax({type:"GET",beforeSend:function(e){e.withCredentials=!0,e.setRequestHeader("Authorization","Basic "+btoa("x:"+m))},url:ApiSite+"organizations/",async:!0,cache:!1,dataType:"json",success:function(e){if(e.length>1){localStorage.setItem("sd_is_MultipleOrgInst","true");for(var t=e,a=0;a<t.length;a++){var i="<li class=item><div id='org' data-id="+a+" class='OptionWrapper1'><h3 class='OptionTitle user_name'>"+t[a].name+"</h3></div></li>";$("#orgsPage").append(i)}$(document).on("click","#org",function(){var t=$(this).attr("data-id");l=e[t].key,r=e[t].name;var a=e[t].instances;if(localStorage.setItem("userOrgKey",l),localStorage.setItem("userOrg",r),0==a.length)return void z.showMessage(!1,"You are not associated with any Instance in the Organization or your account is inactivated in the Instances.");if(1==a.length)u=a[0].key,localStorage.setItem("userInstanceKey",u),q(l,u);else{$("div.OptionWrapper1[data-id!='"+t+"']").parent().remove();for(var i=0;i<a.length;i++){var o="<li class=item><div id='inst' data-id="+i+" class='OptionWrapper2'><h3 class='OptionTitle user_name'>"+a[i].name+"</h3></div></li>";$("#instsPage").append(o)}$(".instSelect").show(),$(document).on("click","#inst",function(){var e=a[$(this).attr("data-id")].key;localStorage.setItem("userInstanceKey",e),localStorage.setItem("sd_is_MultipleOrgInst","true"),$("#loading").show(),q(l,e)})}})}if(1==e.length){l=e[0].key,r=e[0].name,localStorage.setItem("userOrgKey",l),localStorage.setItem("sd_is_MultipleOrgInst","false"),localStorage.setItem("userOrg",r);var i="<li class=item><div id='org' data-id=0 class='OptionWrapper1'><h3 class='OptionTitle user_name'>"+e[0].name+"</h3></div></li>";$("#orgsPage").append(i);var o=e[0].instances;if(1==o.length)u=o[0].key,localStorage.setItem("userInstanceKey",u),q(l,u);else{for(var a=0;a<o.length;a++){var i="<li class=item><div id='inst' data-id="+a+" class='OptionWrapper2'><h3 class='OptionTitle user_name'>"+o[a].name+"</h3></div></li>";$("#instsPage").append(i)}$(".instSelect").show(),$(document).on("click","#inst",function(){var e=o[$(this).attr("data-id")].key;
localStorage.setItem("userInstanceKey",e),localStorage.setItem("sd_is_MultipleOrgInst","true"),$("#loading").show(),q(l,e)})}}},complete:function(){l=localStorage.getItem("userOrgKey"),u=localStorage.getItem("userInstanceKey"),l&&u||reveal()},error:function(){console.log("fail @ getOrg"),logout()}})}},W={init:function(){this.justClicked()},justClicked:function(){$(document).on("click",".responseBlock",function(){localStorage.setItem("ticketNumber",$(this).attr("data-id")),window.location="ticket_detail.html"}),$("#invoiceOption").click(function(){window.location="Invoice_List.html"}),$("#allInvoice, #invoiceFooter").click(function(){window.location="allInvoice_List.html"}),$(document).on("click",".invoiceRows",function(){localStorage.setItem("invoiceNumber",$(this).attr("data-id")),window.location="invoice.html"}),$(document).on("click",".tableRows, .listedAccount",function(){localStorage.setItem("DetailedAccount",$(this).attr("data-id")),window.location="account_details.html"}),$(document).on("click",".responseBlock",function(){localStorage.setItem("ticketNumber",$(this).attr("data-id")),window.location="ticket_detail.html"}),$(document).on("click","#queue",function(){localStorage.setItem("currentQueue",$(this).attr("data-id")),localStorage.setItem("currentQueueName",$(this).find(".OptionTitle").text()),window.location="queueTickets.html"}),$(document).on("click","#asUserStat",function(){localStorage.setItem("ticketPage","asUser"),window.location="ticket_list.html"}),$(document).on("click","#techStat",function(){localStorage.setItem("ticketPage","asTech"),window.location="ticket_list.html"}),$(document).on("click","#asAltTechStat",function(){localStorage.setItem("ticketPage","asAltTech"),window.location="ticket_list.html"}),$(document).on("click","#allTicketsStat",function(){localStorage.setItem("ticketPage","allTickets"),window.location="ticket_list.html"}),$(document).on("click","#addAccountTicket",function(){var e=localStorage.getItem("DetailedAccount");console.log(e),localStorage.setItem("addAccountTicket",e),window.location="add_tickets.html"})},menuFunctions:function(){var e=localStorage.getItem("techStat");null==e?$(".menuTicketsStat").hide():(e>100&&(e=99),$(".menuTicketStatNumber").html(e))}},z={init:function(){this.showMessage()},setMessage:function(e,t){localStorage.setItem("userMessage",t),localStorage.setItem("isMessage",e?"truePos":"trueNeg")},showMessage:function(e,t,a){if("undefined"==typeof e){var i=localStorage.getItem("isMessage");if("truePos"==i)e=!0,localStorage.setItem("isMessage","false");else{if("trueNeg"!=i)return;e=!1,localStorage.setItem("isMessage","false")}}"undefined"==typeof t&&(t=localStorage.getItem("userMessage"));var o=e?".errorMessagePos":".errorMessageNeg";$(o).html(t),$(o).slideDown(100),setTimeout(function(){$(o).slideUp(100),"function"==typeof a&&a()},3500)}};!function(){if(z.init(),d.init(),F.init(),g.init(),y.init(),location.pathname.indexOf("index.html")<0&&"/"!=location.pathname&&location.pathname.indexOf("org.html")<0){var e=navigator.userAgent.match(/iphone|ipad|ipod/i)&&parseInt(navigator.appVersion.match(/OS (\d)/)[1],10)>=7;if(e){var t=document.getElementsByTagName("header")[0];t&&(t.style.paddingTop="10px",t.style.height="63px",$("body").css("margin-top",function(e,t){return parseInt(t,10)+10+"px"})),t=document.getElementById("ptr"),t&&(t.style.marginTop="10px")}if(T.init(),W.init(),localStorage.lastclick){if(((new Date).valueOf()-Date.parse(localStorage.lastclick).valueOf())/60>1200)return localStorage.lastclick=new Date,void q("","",!1,s)}else localStorage.lastclick=new Date;s()}}()});